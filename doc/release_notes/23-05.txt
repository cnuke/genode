

              ===============================================
              Release notes for the Genode OS Framework 23.05
              ===============================================

                               Genode Labs



; intro
; @nfeske


Goa tool updated to Sculpt OS 23.04, initial support for Rust
#############################################################

Last month, we [https://genode.org/news/sculpt-os-release-23.04 - released]
Sculpt OS 23.04 for PC and PinePhone. The new release comes with various
[https://genodians.org/nfeske/2023-05-11-sculpt-os - usability improvements]
such as presets and on-target system updates.

[image mobile_sculpt_23_04]

In particular, with Sculpt OS 23.04 running on the PinePhone, we have carved out
the base for hosting mobile apps on a Genode-based system. Yet, there are
only very few apps available right now. Since an OS is of no practical use
without apps, this urgently called for an SDK to simplify (mobile) app
development. After careful investigation, we opted for porting the
Ubuntu-Touch-UI toolkit to Genode and integrate it into Goa (Section
[Using Goa for bringing apps based on the Ubuntu-Touch-UI toolkit to Genode]),
our streamlined workflow tool for application development.
In addition, we integrated initial support for Rust's _cargo_ to make Goa
palatable to a broader developer audience (Section [Initial Rust support]).

The growing attention of the Goa tool prompted us to move it under the
[https://genodians.org/nfeske/2023-05-02-goa-genode-labs - umbrella of Genode Labs]
as we are increasing our development and maintenance efforts for
the tool. Aligned with the Sculpt release, the Goa tool has been updated with
the corresponding depot archive versions.
With this Genode release, we put a cherry on top and added bash completion to
improve the user experience even further. Having Goa installed, bash completion
is enabled by the following commands:

! goa update-goa master
! GOA_DIR=$(realpath $(which goa) | sed s#bin/goa##)
! echo "${GOA_DIR}/share/bash-completion/goa" >> ~/.bashrc

:Goa tool:

  [https://github.com/genodelabs/goa/]


Using Goa for bringing apps based on the Ubuntu-Touch-UI toolkit to Genode
==========================================================================

While writing a stop watch app might be fun, it is outside our core
expertise. Therefore, we have looked into ways of supporting established
open-source SDKs for app development on Genode. We investigated two possible
options in depth, namely Ubuntu Touch's UI toolkit now called
[https://lomiri.com - Lomiri] and the
[https://docs.sailfishos.org/Tools/Sailfish_SDK - Sailfish SDK]. We have tried
to port applications for both stacks and after many iterations settled with the UI
toolkit. The full story can be read
[http://genodians.org/ssumpf/2023-05-06-ubunutu_ui - here]. Therefore, a port of
the Ubuntu UI toolkit is available on Genode right now and support for it has been
added to the Goa tool.

The workflow for crafting an app for the PinePhone using the Goa tool is a
fairly streamlined experience now:

# Since the UI toolkit depends on Qt5 add "genodelabs/api/qt5" to your
  _used_apis_ [https://genodians.org/nfeske/2019-11-25-goa - file]

# Add "ssumpf/pkg/ubuntu_ui_toolkit" to your _archives_
  [https://genodians.org/nfeske/2019-11-25-goa - file] to have the UI toolkit
  available within your package

# In order to have your QML code within your packet installed, add
  "<packet-name>.tar: install/" to your _artifacts_
  file [https://genodians.org/nfeske/2019-11-25-goa]

# Configure your _runtime_
  [https://genodians.org/nfeske/2019-12-19-goa-unix-terminal - file]

# Execute your scenario on Linux for development
  ! goa run

# Build for the PinePhone
  ! goa build --arch arm_v8a

# [https://genodians.org/nfeske/2020-01-16-goa-publish - Publish] your packet
  ! goa publish --depot-user john --depot-overwrite

Examples using QML, Qt5, and C++ can be found
[https://github.com/ssumpf/goa-projects - here]


Initial Rust support
====================

; @atopia




Uniform Wifi stack across PC and ARM platforms
##############################################

; @cnuke

commit 23cc96e661d2ef6b9b17bcfabad686598231c6f2
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Thu Mar 2 18:22:45 2023 +0100

    wifi/pc: add firmware for the Intel AX210

commit 118fff04728d14a852b7f3b0ca03affdff28e844
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Mon Apr 3 11:37:45 2023 +0200

    iwlwifi: limit rx bufs to 2048
    
    Recent devices are configured with 4096 RX pages that lead to an
    increased memory usage. For the moment lower the amount to 2048
    and treat in potientially lower throughput for more conservative
    memory consumption.
    
    Fixes #4801.

commit 1041ed87734f08ab781f5a4c6e408a66b4d9bc31
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Thu Apr 6 14:13:49 2023 +0200

    wifi: use latest available firmware
    
    This commit updates the used firmware images for the iwlwifi device
    to latest available ones (supported by the current 6.1.x driver).
    It also removes old firmware images that by now are not used anymore.
    
    Fixes #4807.

commit 56d366995c0737962a29e13becc0d4eb305d8c25
Author: Josef Söntgen <jws@sysret.de>
Date:   Wed Jan 11 17:16:36 2023 +0000

    wifi/pc: add ath9k driver
    
    The driver was only tested with an "Atheros AR9462 Rev:2" [168c:0034]
    device using the 'wifi.run' run script.
    
    Note: for it to work MSI may not be used as otherwise interrupts do not
    work. Using an IOMMU leads to the following fault:
    
    [ 0] IOMMU:0xffffffff817eb0b0 FRR:0 FR:0x22 BDF:4:0:0 FI:0xb0000000000000 (0)
    
    Issue #4813

commit 8ae5ae76fb7ff6bf2e4d62f38adf72b05ea661e1
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Jan 25 14:53:00 2023 +0100

    wifi: support building for ARM64
    
    This commit introduces support for building the WLAN driver for ARM
    platforms. It makes the WPA supplicant and its support libraries
    available for all platforms. It also seperates the PCI parts to
    accommodate platforms where other bus protocols are used.
    
    Issue #4813

commit 0b08ae09c40fa0a50d50cb575b9a7e072877788c
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Tue Feb 28 14:33:14 2023 +0100

    wifi: check 'lx_get_mac_addr' before reporting
    
    The MAC address device report should be published once the device is
    available. Since this may happen at a later time we have to check the
    call.
    
    Issue #4813

commit eaaedb6ae892d90afcce57655742a79a48249cc3
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Fri Mar 10 16:53:35 2023 +0100

    wifi: defer supplicant start-up
    
    The SDIO connected wireless device on the PinePhone is not available
    on start-up, which leads to the supplicant failing to initalize
    'wlan0'. Normally the supplicant would be used in a way that handling
    devices that appear at run-time happens gracefully.
    
    Rather than supporting this behavior we defer the start-up of the
    supplicant until the device could be openend successfully for now.
    
    Issue #4813

commit e6ee7d3d4ae9cca5c6c22dfd0f83a734ba37e40b
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Fri Mar 10 16:53:01 2023 +0100

    wifi: provide platform specific DTB access
    
    The device-tree binary is normally required on ARM-based platforms
    where as on x86 it is omitted. The platform-specific DTB helper
    provides a generic interface for accssing the DTB and needs to be
    implemented on each platform.
    
    Issue #4813

commit 0b28c9ae6f506b1e7873b6b73b3447880a08130b
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Wed Apr 12 09:17:22 2023 +0200

    lib/vfs/wifi: remove dependency on wifi library
    
    The wifi VFS plugin is solely there to provide a hook for calling
    'Lx_kit::initialize()' prior to the static ctors. As the corresponding
    symbol can be resolved at run-time there is no need to add the
    library as a build-time dependency.
    
    Issue #4813

commit 6c36a58bb73731250508bee20bdc3fdbdf1bf468
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Wed Apr 12 13:37:17 2023 +0200

    lib/wifi: remove unused symbols from symbol.map
    
    Remove symboles that are no longer required.
    
    Issue #4813

commit 2b4246c59be466094789796d1adfdfaec69f3b44
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Wed Apr 12 13:39:38 2023 +0200

    lib/symbols/wifi: add symbols file for ABI so
    
    Add symbols file for the wifi shared-object.
    
    Issue #4813

commit 8f91f119b88cdce4915fedc81fe6163388179423
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Wed Apr 12 13:56:12 2023 +0200

    wifi: remove firmware library
    
    The library is merely an historical artifact and the raw archive is
    better used in its place.
    
    Issue #4813

commit 1d376717c1653c5ed455ee3a8bae975aa96e52b4
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Thu Apr 13 15:26:00 2023 +0200

    net/netaddress: make copy member function const
    
    As the function does not alter the internal state of the
    object allow for using it in r/o contexts.
    
    Issue #4813


commit d81fbaa4d40d2eaf3a0a34b53bf8112b30ba41c4
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Thu Mar 30 16:59:35 2023 +0200

    (allwinner) wifi/a64: add driver for rtl8723cs
    
    This commit adds a driver component for the PinePhone's RTL8723CS based
    WLAN device. It is port from Linux (orange-pi-5.14-20211103-1304) and
    behaves similar to the PC driver.
    
    Issue #17.


Base framework and OS-level infrastructure
##########################################

New tool chain based on GCC 12.3, C++20 enabled by default
==========================================================

Following our regular cycle of two years, we updated our tool chain to recent
versions again, this time in particular to GCC 12.3.0,
binutils 2.40, and GDB 13.1 while taking the opportunity to enable C++20 by default.

A noticeable change with GCC 12 is that auto-vectorization with
the '-ftree-vectorize' option is now enabled by default when
building with the '-O2' optimization level. This has the effect
that SIMD instructions are generated more, which required adaptations
throughout our code base, for example by making sure that
memory allocations in ported Linux drivers adhere a suitable
address alignment and by saving and restoring ARMv8 FPU registers
in the dynamic linker.

In addition to that, GCC 12 reports new warnings and errors, which we
had to fix at various places, the most common ones being:

* Deprecated arithmetics between different enumeration types,

* Deprecated use of ++/-- operators with volatile variables, and

* Undefined references to 'strlen' inside custom implementations
  of 'strlen'-like functions, related to the
  '-ftree-loop-distribute-patterns' option.

As an extra feature, we added Genode's library name patterns
to the linker so that the '-l' option has become able to find the corresponding
libraries. This is useful while porting 3rd-party software based on Autoconf,
whenever a 'configure' script checks for a library dependency by linking
a test program with this option. This change thereby removes the need for
dummy libraries that were formerly used to satisfy the probing.


API changes
===========

As part of Genode's
[https://genode.org/documentation/release-notes/16.08#Cultivation_of_the_new_text-output_API - great API revision]
in 2016, we largely *abolished* the use of *format strings* throughout the
framework. This is desirable because a code base without format strings cannot
have format-string vulnerabilities. Still, a few occurrences, specifically the
interface for passing session-construction arguments, remained untouched since
then. With version 23.04 we finally attained our initial goal by wrapping up
the transition.

In particular, we revised 'Genode::Connection', which now accepts the session
label, affinity, and session-specific parameters as constructor arguments,
whereas the parameters are passed as a 'Genode::String'. This eliminates the
need for rendering a format string. Given this new interface, we were able to
remove format strings from all connection types, updated all components that
still happened to rely on format strings, and ultimately removed format
string from Genode's base API.

Format strings still play a role to accommodate 3rd-party code ported
to Genode. Whenever the 3rd-party code targets the C runtime, format
strings are readily available via the libc. For free-standing ports that
avoid the dependency from the full C runtime, e.g., ported device drivers,
a new 'format' library based on Genode's former _base/snprintf.h_ and
_base/console.h_ provides rudimentary format-string support. The library
is hosted in the libports repository.

As another matter of house keeping, we removed the _util/avl_string.h_
utility. The use case of organizing objects by using strings as keys is
covered by the _util/dictionary.h_ now.


Towards kernel-agnostic DMA protection
======================================

As sketched in our [https://genode.org/about/road-map - road map], we plan
having a feature-complete PC version of Sculpt OS based on base-hw by the end of
this year. One of the reasons why we are still sticking to base-nova for the PC
version is the fact that we are relying on NOVA's IOMMU support. One necessary
step to decouple Sculpt OS from base-nova is to integrate the IOMMU handling
into the platform driver.

Motivated by our
[https://genode.org/documentation/release-notes/23.02#Custom_IP_block_for_DMA_protection_on_AMD_Xilinx_Zynq - custom IP block for DMA protection on AMD/Xilinx Zynq],
we integrated the notion of IOMMU-like devices into the platform driver with
this release as a preparatory step. The platform driver automatically acquires
known IOMMU-like devices for itself by looking at the device types. Other
devices can then reference these devices by using '<io_mmu>' nodes. This is best
illustrated by looking at the devices ROM for the Zynq's dma_guard IP block:

! <devices>
!
!   <device type="dma_guard" name="dma_guard_0">
!     <!-- [...] -->
!   </device>
!
!   <device type="axi_dma" name="axi_dma_0">
!     <io_mmu name="dma_guard_0"/>
!     <!-- [...] -->
!   </device>
!
! </devices>

This tells the platform driver that, whenever a DMA buffer is allocated/freed
for the session owning the 'axi_dma_0' device, the 'dma_guard_0' must be
configured accordingly in order to allow/deny access to the corresponding memory
ranges. With the structural changes to the platform driver, the support for
dma_guard devices is simply added by implementing specific 'Io_mmu' and
'Io_mmu_factory' objects. You can find the code in the _dma_guard.h_ within
the
[https://github.com/genodelabs/genode-zynq/blob/master/src/drivers/platform/zynq/dma_guard.h - genode-zynq repo].

For the PC version of the platform driver, we implemented a _kernel_iommu_
device that still uses device PDs to pass IOMMU configuration to the NOVA kernel.
The _kernel_iommu_ is automatically instantiated and used as a default for each
device until we replaced this by a kernel-agnostic implementation in a future
release.

With these preparations, we paved the way for implementing configuration logic
for arbitrary IOMMU-like devices within the platform driver. In particular, the
platform driver has been made capable of managing multiple IOMMU-like devices
at the same time. However, there is one limitation that comes from the fact that
DMA buffers are not device-specific but allocated per session: All IOMMU-like
devices must either operate as MMU (virtual addressing) or as MPU
(physical addressing).


Revision of Genode's custom block-encryption infrastructure
===========================================================

Tresor library
~~~~~~~~~~~~~~

For about two years, our Ada/SPARK-based CBE block encryption and its GUI
front-end, the file vault, served us well with rather manageable workloads
such as configuration and credential files in Sculpt OS in the PC. However, with the
rise of mobile Sculpt on the PinePhone, the CBE ecosystem was suddenly
confronted with new challenges and requirements.

* Mobile platforms are usually less forgiving when it comes to performance and
  the CBE still exhibited a lot of potential for optimization.

* We envision encrypted storage to become an integral part of the base
  system - the "appliance role" of mobile Sculpt OS - which shifts the role
  of the component from an optional feature to a foundational mechanism.
  With this role shift, however, maintainability becomes increasingly important.

* Now that we decided to settle on this approach to block encryption and
  will increasingly expose it to real workloads, we can expect new requirements
  to pop up more frequently and with higher priority.

* And, last but not least, our SPARK/Ada runtime, so far, lacks ARM support.

This prospect forced us to carefully reconsider our relation to the existing CBE
approach, and especially to the fact that its core logic and crypto back-end
were entirely written in Ada/SPARK. When we started developing the CBE in
Ada/SPARK, we were positive that the language might become popular
among the core developers of Genode and that, eventually, other, especially
critical parts of the framework could benefit from it as well. But this idea
didn't come to fruition. Only a few of us came in touch with the new language
and, of those, even fewer acquired profound experience with it. We ultimately
realized that the friction caused by the added language boundary that emerged
with the CBE approach became a bottleneck, inhibiting the further evolution
of our block-encryption stack with a strong sense of collective code ownership.

This observation in mind, and the above mentioned challenges in sight, we decided to
drop the CBE library and create a new implementation strongly inspired by the
CBE design but in C++, our "mother tongue". The new library is called tresor,
brings the same feature set as the CBE and is compatible with
containers created with the CBE. The file vault has been adapted to
run with the tresor library. So file-vault users can continue using their containers as
usual without further ado. The entire tresor-based ecosystem is
architecture-agnostic, which lifts the former restriction to x86.


File Vault
~~~~~~~~~~

There are some new features to the file vault. For instance, the component can
now be driven with one of two available user interfaces: The usual graphical
front-end or the new non-interactive interface that is driven by a textual
configuration and provides feedback through a report. This allows
for the integration of the file vault with automated controls respectively
lower or higher-level UIs. The interactive interface remains the default but one
can replace it with the text-based variant using the new "user_interface"
configuration flag (not re-configurable). An example of operating the
test-based interface is provided by the new _file_vault_config_report.run_ script.

Another rather small but handy feature is that a file vault can now be locked
and unlocked without having to restart the component. In the locked state,
all key material is removed from the cryptographic back end and the
block-encryption driver is shut down. The user is then prompted to provide the
correct credentials in order to re-establish access to the container.


Custom virtual machine monitor on ARM
=====================================

With the
[https://genode.org/documentation/release-notes/23.02#Interactive_graphical_VMs_on_ARM - previous release], interactive graphical VMs got introduced on ARM systems.
Genode's custom virtual machine monitor was enhanced by VirtIO device models for
input events and GPU. However, dynamic changes of the virtual GPU's framebuffer
resolution weren't yet handled by the initial version.
With current release, these restrictions got removed. Now, the user is able to
resize the window of a virtual machine as expected.


NetBSD rump kernel on RISC-V
============================

We have added RISC-V to our port of the
[https://wiki.netbsd.org/rumpkernel - rump kernel].
This enables Genode to access commodity file-systems on RISC-V based devices.


Strengthened fault tolerance of on-target package management
============================================================

Genode's way of safely installing and deploying packages on-target - as introduced in
[https://genode.org/documentation/release-notes/18.02#On-target_package_installation_and_deployment - version 18.02] -
is a corner stone of Sculpt OS. The recent move of Sculpt OS to mobile devices,
however, revealed a couple of limitations that we addressed with the current
release.

First, in contrast to the PC version of Sculpt OS that allows for the
straight-forward management and editing of files using a regular command-line
interface, a touch-based user interface as present on the phone is far more
constrained. Problems that can be solved by manual intervention on the PC
without a second thought can become insurmountable showstoppers on the phone.
The most prominent problem is the recovery from the situation where package
dependencies remained incomplete due to an interruption of the installation
process or due to packaging mistakes. On the PC, such a situation can be resolved
by simply clearing the depot using a single terminal command, followed by a
reinstall of the package. On the phone, the user was left out in the cold
with the message "package installed but incomplete" but with no obvious or
non-obvious way of recovery. The new version gracefully handles this failure
state by offering the retry of the package installation.

Second, network connectivity is far more fluctuating on mobile devices,
which increases the likelihood for download errors. The previous version that
regarded download errors as rare and sporadic issues, responded to such
errors by repeated and silent retrying. We found that a mobile phone demands
more graceful way to reflect such failure situations to the user, and to limit
the rate of futile download attempts. The new version preserves information
about download failures for user inspection and re-issues new downloads only
if not already flagged as unavailable.

Finally, we encountered the manual addition of software providers to the
system as a hurdle on the phone. On the PC, a new software provider can be
added by manually placing the provider's _download_ and _pubkey_ files the
local depot directory, which is straight-forward when using a shell. However,
on a touch-screen device, there is no obvious and simple way to supplement the
system with such information. To still accommodate the user's desire to
download and install software from arbitrary providers, we added the option to
explicitly skip the signature verification for downloads. This is useful in
scenarios where the lack of integrity of downloaded content does not pose a
risk, e.g., for untrusted applications that are rigidly sandboxed, or during
development.

Whenever the depot-download subsystem encounters the attribute 'verify="no"'
for an '<installation>' item, it accepts the installation even if no key is
available. It still applies verification for dependencies whenever possible.
E.g., if a package of the provider "jon" gets installed via 'verify="no"' and
the package depends on an archive by "genodelabs", for which the public key is
known, the integrity of the content originating from "genodelabs" is verified.


Libraries and applications
##########################

Qt5 reorg
=========

When the Goa tool is used to build an application, all libraries
of the used API packages get linked to the application and the
single Qt5 API package with big libraries like QtWebEngine was
a bit too much for simple Qt applications. For this reason we
split the Qt5 API into smaller packages according to the
corresponding Qt modules.

As preparation for the release of a binary version of the
Qt5 host tools, we also reduced the external dependencies of
these tools for improved compatibility with different host
systems and changed their install location to the location of
the other Genode host tools.

And finally, we added a 'ubuntu-ui-toolkit' meta package in the
genode-world repository which pulls in all dependencies for the
Ubuntu UI toolkit, including a runtime with the required ROMs.


WireGuard improvements
======================

There are two smaller changes related to Genode's port of WireGuard. First,
peers can now be removed from WireGuard at runtime by removing the
corresponding <peer> tags from the component configuration. This operation
enforces the same assurances as removing a peer from a native WireGuard driver
in Linux.

The second change has to do with the nature of the port. The WireGuard port is
one of the rare examples where we use our Linux device driver environment
(dde_linux) for porting something that is not exactly a driver. The component
does not depend on a specific hardware configuration and therefore, the
emulated Linux kernel can be platform-agnostic. Consequently, while porting, we
created such a variant of the Linux emulation specifically for WireGuard.

However, we realized that this variant can come in handy for ports of other
hardware-agnostic kernel parts (for instance, lxip) as well. Therefore, we now
cut it out of the WireGuard port in order to make it a self-contained version
of the 'lx_emul' library. The new library is called 'virt_lx_emul' and is
accompanied by the 'virt_linux' target that can be used to build the
corresponding Linux kernel and run it in Qemu.

Updated or removed 3rd-party software
=====================================

VirtualBox updated to version 6.1.44
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

; @chelmuth

commit 37421a7879ff47b6c64f249f91a9352b4260ff72
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Thu Oct 27 09:25:07 2022 +0200

    vbox6: bump version from 6.1.26 to 6.1.44
    
    Fixes most of the GCC 12 problems.
    
    issue #4666

commit 7be915a185a442b14f66ccfe5715787a3758d659
Author: Christian Helmuth <christian.helmuth@genode-labs.com>
Date:   Wed Sep 21 09:28:19 2022 +0200

    vbox6: disable RDTSC exit
    
    For Windows guests, it's crucial to configure the paravirtualization
    provider in .vbox6 like follows. Otherwise, the TSC calibration fails
    (issue #4726) and the CPU frequency (in task manager) is bogus.
    
      <Paravirt provider="HyperV"/>
    
    Fixes #4726

commit 7e06aa13c17293eeb651d24610f3d99478a62dc5
Author: Christian Helmuth <christian.helmuth@genode-labs.com>
Date:   Thu Apr 20 15:41:31 2023 +0200

    vbox6: disable GSO in e1000 model
    
    Commit "vbox: avoid uncaught nic Empty_ack_queue exception" introduced a
    performance regression due to packet retransmission because of faulty
    GSO segment handling. As fixing the GSO handling is fairly complex, we
    disable GSO until a fix was developed.
    
    Issue #4820
    Issue #4821

commit a1eb94535d774322bb3b8a1176a231e9050c93f3
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Tue May 16 19:30:56 2023 +0200

    qemu-usb: support read/write of unused IO ranges
    
    The XHCI model reserves 0x4000 of IO memory but uses only 0x530.
    Implement read (0) and write (nop) for these regions as real hardware
    does.
    
    fixes #4902


Removed ports of pcre16 and icu libraries
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The pcre16 and icu libraries had been used by Qt5 in the
past, but were not used anymore since the last Qt updates,
so we removed them from the 'libports' repository.


Device drivers
##############

Linux device driver environment updated to Linux 6.1.20
=======================================================

According to the roadmap, the update of Genode's Linux device driver environment
to a more recent 6.x Linux version was planned for release 23.08. Now, we
decided to bring this update forward.

Not all drivers dependent on this special runtime got updated at once. The
existing drivers for the Allwinner and i.MX 8MQ SoC still use older 5.x Linux
kernel versions as base. However, the Linux device driver environment was
tweaked carefully to support a range of Linux kernel versions from 5.11 till
6.1.20.

Beside the Wireguard port to Genode, the following ported drivers already use
the latest Linux kernel 6.1.20 version:

* Zynq SD-card driver
* PCI Wifi driver for i.MX 8MQ
* all PC drivers (USB, Wifi, Intel display)

While doing the update work, we investigated a more sustainable link in between
the Linux kernel drivers for USB and display drivers (DRM/KMS) one the one hand,
and the Genode API on the other. The outcome is explained in the upcoming two
sections.

Intel display driver
====================

; @alex-ab

commit e1533be6849b26ffab178c52afbbcad4a8a81751
Author: Alexander Boettcher <alexander.boettcher@genode-labs.com>
Date:   Fri Mar 24 16:01:48 2023 +0100

    intel/display: replace intel_fbdev with drm/kms
    
    Fixes #4806


USB
===

Connecting different USB clients to an USB host controller driver is a crucial
task anyway. When using a Linux kernel driver port it becomes error-prone
quickly, because the USB driver API in the Linux kernel is complex and contains
some semantic dependencies, for instance regarding synchronization, which are
not always obvious.
However, the Linux kernel offers an USB device I/O API to the user-land that is
used for instance by the libusb. This API has to guard the USB subsystem against
wrong usage, and implements the necessary semantics regarding synchronization
and dynamic changes of clients and devices.
In the past we encountered repeatedly corner-case issues, if clients or devices
vanished and appeared heavily. For the sake of robustness we decided to re-new
our internal linking in between the Genode USB API and Linux to use the
user-level device I/O API of the latter.
Moreover, we extended the capacity of USB packets in-flight that can be handled
by the controller in parallel to 32, to enhance the throughput for some USB
devices.

NVMe storage
============

; @cnuke

commit ae0e0c118ea07eca66022d8b2cca2d50594a62c3
Author: Josef Söntgen <jws@sysret.de>
Date:   Sun Nov 13 20:10:43 2022 +0000

    nvme_drv: add support for host-memory-buffer
    
    This commit introduces support for the HMB feature and will setup the
    buffer during start-up. The host-memory-buffer (HMB) feature is mostly
    used on NVMe devices that do not make use of an DRAM cache to store its
    translation tables amongst other operational data. Not using HMB can
    impair the performance on such devices.
    
    The memory is allocated in 2 MiB chunks of DMA-capable memory and its
    total size in bytes is configurable via the 'hmb_size' config attribute.
    The driver always checks the minimal and preferred size of the HMB and
    issues a warning in case it is not enabled via the configuration.
    Moreover, if the configured size is less than the minimal amount
    required by the device the HMB is not configured at all and a warning
    is issued also. If the configured size is more than the preferred size
    it will be capped to that amount.
    
    Fixes #4715.

commit 280724e6b5b68e32135b40632ff44c10581d6d3e
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Fri Apr 28 17:38:10 2023 +0200

    nvme_drv: read proper FLBAS value
    
    Bit 0:3 indicate which of the (up to) 16 supported LBA formats is
    used for this namespace. Instead of only looking at those bits the
    driver looked at the complete 0:7 bits. Those, however, also include
    information on how metadata may be transferred. That leads to using
    the wrong index for reading the LBA format.
    
    Fixes #4832.


Audio-driver update
===================

; @cnuke

commit 1b552d594b6591874db83ba7236b65cb39dda0e2
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Thu May 4 14:25:34 2023 +0200

    dde_bsd: update audio driver to OpenBSD 7.3
    
    Fixes #4857.


Platforms
#########

Base-HW microkernel
===================

Principle x86 virtualization support (on Qemu)
----------------------------------------------

; @atopia

Boot-time RAM detection on the PinePhone
----------------------------------------

On the PinePhone we implemented dynamic detection of the system RAM size by
parsing the values of the DRAM controller as programmed by U-Boot. This way, 2
and 3 GB models of the PinePhone are supported by Genode.


Updated seL4 microkernel
========================

; @alex-ab


