

              ===============================================
              Release notes for the Genode OS Framework 22.11
              ===============================================

                               Genode Labs



; intro -> @nfeske


Hardware-software co-design with Genode on Xilinx Zynq
######################################################

; @jschlatow


; Mention Goa enhancements?


commit 98a201fa3ba4f41aa7d825ac42e7c98c0ca351ef
Author: Johannes Schlatow <johannes.schlatow@genode-labs.com>
Date:   Fri Sep 16 14:33:00 2022 +0200

    implement devices manager
    
    The devices manager takes care of merging a static 'devices' ROM and a
    bitstream-dependent set of devices. The latter is specified by the
    component config. The result is provided in terms of a report and is
    intended to be consumed by the platform driver.
    
    genodelabs/genode-zynq#2

commit 6134049742dc7112efbfad1714f16d22bf2ce26a
Author: Johannes Schlatow <johannes.schlatow@genode-labs.com>
Date:   Fri Sep 16 15:01:22 2022 +0200

    drivers_fpga: allow switching between bitstreams
    
    In order to allow switching between bitstreams, the following changes
    are applied to the `driver_fpga-zynq` subsystem:
    
    - The `fpga_devices` ROM is replaced by a `devices_manager.config`.
    - The `fpga.bit` ROM is replaced by a File_system session. The file
      system is accessed by an internal `fs_rom` component translating ROM session
      request by the internal `fpga_drv`. The file system must therefore provide
      the bitstream data as well as a `/config` file containing the driver's
      config ROM.
    
    Fixes genodelabs/genode-zynq#2

commit e05c638bae30da905511b92fb97279fccf5fff38
Author: Johannes Schlatow <johannes.schlatow@genode-labs.com>
Date:   Fri Sep 9 13:38:46 2022 +0200

    implement Pin driver
    
    The Pin driver for the Zynq-7000 SoC is largely based on the a64_pio_drv
    from the genode-allwinner repository. Most of the code could be shared
    and went into `common_types.h` and `main.cc`. The platform-specific
    parts (register interface, irqs, number of banks and pins) is thereby
    kept minimal.

commit 96bb29a4e8f672b3bc4486c8fc95b9efc70f9259
Author: Johannes Schlatow <johannes.schlatow@genode-labs.com>
Date:   Fri Sep 16 16:57:15 2022 +0200

    driver_manager: add Irq and Pin services

commit 31381f0bcc7975224b2ec126b0ebf1a9395e65cd
Author: Johannes Schlatow <johannes.schlatow@genode-labs.com>
Date:   Fri Sep 16 16:08:10 2022 +0200

    Zybo-Board GPIO demo
    
    The demo controls all on-board LEDs, buttons and switches. Since most
    GPIOs are connected to the PL, we must load a bitstream with the
    corresponding routing first. The demo also illustrates how to switch
    bitstreams at runtime.
    
    - Btn4 loads the bitstream allowing MMIO control of the RGB LEDs 5 & 6.
    - Btn5 loads the bitstream without support of RGB LEDs.
    - Sw0 controls Led0.
    - Sw1 controls Led1.
    - Sw2 controls Led2.
    - Sw3 controls Led3.
    - Btn0 controls the colour of Led5.
    - Btn1 controls the brightness of Led5.
    - Btn2 controls the colour of Led6.
    - Btn3 controls the brightness of Led6.

commit d40a88377de5764a099e27069534be8371b9aeca
Author: Johannes Schlatow <johannes.schlatow@genode-labs.com>
Date:   Tue Nov 22 16:05:13 2022 +0100

    platform_driver: get/set fpga clock rates

commit caa3886d063e7c3d1626e78b572160f771c58a61
Author: Johannes Schlatow <johannes.schlatow@genode-labs.com>
Date:   Wed Nov 23 11:57:25 2022 +0100

    platform_driver: add fpga reset domains

commit 4ad81eb692764af78d6fb4dddc59a50c83cf3094
Author: Johannes Schlatow <johannes.schlatow@genode-labs.com>
Date:   Fri Nov 25 11:37:13 2022 +0100

    fpga_drv: fix occasional freeze on reconfiguration
    
    Reconfiguration apparently also requires asserting the FPGA resets and
    setting the voltage level shifters. This is now supported by the
    platform driver, which provides the reset domain "fpga_nreset" for this
    purpose. By binding this reset domain to the devcfg device, the fpga
    driver is able to halt the fpga when it acquires the device and to reset
    the fpga when it releases the device.

commit 16c05779e52bd1e6f1b08bc5de1e07c2447ea92f
Author: Johannes Schlatow <johannes.schlatow@genode-labs.com>
Date:   Wed Nov 16 12:36:21 2022 +0100

    add tool for extracting device parameters from xsa


Hardware-accelerated graphics with Intel GEN12+ GPUs
####################################################

With our big [https://mesa3d.org - Mesa 3D] library update from version 11.2.2
to version [https://genode.org/documentation/release-notes/21.08 - 21.0.0], we
also switched the Intel graphics back end from the dated DRI2/i965 to the
Gallium/Iris based graphics driver. The reason for doing so is becoming apparent
with the current Genode release. The old i965 driver does not support newer Intel
Graphics hardware and is limited to (U)HD graphics devices found, for example,
on Broadwell, Skylake, or Kabylake platforms. The new
[https://en.wikipedia.org/wiki/Intel_Xe - Intel Xe] (eXascale for
everyone = GEN12) hardware is only supported by the Iris driver and can be found
on current architectures like Tigerlake or Alderlake. Intel Xe comes with a
completely new instruction set architecture (ISA). Thanks to our switch to Iris,
most of these ISA changes are handled transparently by the Mesa library for us.
The main task for Genode was to adjust our Intel GPU multiplexer to the new
graphics-device generation.


Intel GPU-GEN12 multiplexer adjustments
=======================================

Genode's GPU multiplexer is a very low level component within the 3D graphics
stack. Technically, it handles the GPU resources (like graphics memory) and the
scheduling and execution of compiled GPU code (i.e., batch buffers) of the
graphics device. It is also responsible for providing separation of different
GPU clients, which is achieved by GPU contexts with a separate page table per
client in hardware. Also it serves interrupts and informs the clients,
respectively the 3D applications, about progress so a client can submit the
next rendering request. For Intel Xe, there are only two changes within this low
level ISA. First, the interrupt handling registers have been improved. It has
become easier to distinguish, for example, between a display-engine interrupt
and a rendering interrupt. Since graphics cards can have many interrupt causes,
this is a useful and welcome change. Second, it is now possible to schedule 16
instead of 4 jobs onto the GPU. While we don't take advantage of this feature
yet - we schedule one job at a time - this may come in handy on use cases like
3D compositing. Additionally, the multiplexer has to provide information about
slices, subslices, and EUs to Mesa clients.


Stability and resource improvements
===================================

Resources need to be traded on Genode and it is essential that the GPU
multiplexer does not pay for memory allocations or capability upgrades from it's
own budget. The client has to donate these resources beforehand. If this rule is
violated, the multiplexer might run out of budget and stall all clients. Because
3D applications can require a huge amount of resources, this has been a
challenging topic during the last release cycle and we are glad to announce that
even sophisticated workloads are now running well on Genode. There is still room
for improvement, but the current situation is already reassuring.
Stability-wise, we have tested the updated 3D stack with various workloads (games,
browsers, VirtualBox6-3D) and did fix all issues that we came across.


Base framework and OS-level infrastructure
##########################################

Base API changes
================

New 'Dictionary' utility
------------------------

Throughout the Genode code base, there are several places where objects are
accessed by using a name as key. To avoid the repeated manual crafting of such
data structures, we introduced a basic 'Dictionary' data structure located at
_base/include/util/dictionary.h_.

It follow the patterns of the existing 'Id_space' and 'Registry'. That is,
elements are automatically added to the dictionary at construction time,
respectively removed at destruction time. There exists an 'with_element'
method for applying a functor to one element by specifying a name as key, and
an 'with_any_element' method that can be used to destruct all dictionary
items.


Tightening the 'Xml_node' interface
-----------------------------------

The former 'with_sub_node' method has been renamed to 'with_optional_sub_node'
to better reflect the intention of the caller. If no sub node of the specified
type exists, the specified functor is not executed.

Use cases where a sub node is mandatory are best covered by the new
'with_sub_node' method that takes two functors as arguments, one called with
the matching sub node, and one that is called if no such sub node exists.


NIC router
==========

The NIC router now generates reports triggered by internal events
(re-configuration, link state change, etc.) asynchronously. This has the
benefit that the potentially expensive report update does not delay the event
processing that triggered the update and that a report is guaranteed to reflect
a consistent state of the router's internals.

Furthermore, if the '<report>' attribute 'link_state_triggers' is set, the router now
updates the report also whenever a network session gets constructed or
destructed. This is definitely necessary with sessions whose link state
is "up" because we should consider a non-existent session to be "down".
However, in real-world scenarios, a subscriber might want to know about the
construction and destruction of sessions that are "down" as well because one
has to be able to synchronize the lifetime of local objects that keep track
of the link states.

Beside the polishing of the report functionality, there are some improvements
related to the DHCP processing in the router. First, the router is now robust
against invalid DNS addresses in DHCP ACK packets. Next, the DHCP client
doesn't produce oversized Ethernet packets anymore. This is important in
networks with a low bandwidth. Then, the link state of a session that is bound
to the state of a another domain via the '<dhcp-server>' attribute
'dns_config_from' is now correctly synchronized to whether that domain has an
IP configuration or not. And, last but not least, the DHCP server now accepts
the optimized startup sequence of clients like Debian that store their lease
persistently and directly try re-requesting it on boot-up (no DHCP DISCOVER).
These last two changes both prevent DHCP re-attempts that could cause a
significantly delayed network boot-up at applications behind the router.


Improved support for time-multiplexed GPIO pins
===============================================

Prompted by the need to enable a bit-banging I2C driver on the PinePhone,
we extended Genode's pin-driver framework introduced in version
[https://genode.org/documentation/release-notes/21.11#Pin_I_O_session_interfaces - 21.11]
with the support for the time-multiplexed operation of a pin as output or
input.

To operate pin in both directions, a driver obtains both a pin-state and a
pin-control session for the same pin. The pin-state session can be used to
sense the current pin state. The control session allows the client to set the
pin to high or low (using the 'state' method), or to set it to high-impedance
via the 'yield' method. Once switched to high-impedance, the pin can be used
as input.


Libraries and applications
##########################

Emerging Sculpt OS variant for the PinePhone
============================================

Genode on the PinePhone has come a long way, most of which is covered by the
[https://genode.org/documentation/genode-platforms-22-05.pdf - Genode Platforms]
document. Device-driver work accounts for the majority of the effort, which is
nicely wrapped up with the current release as described in
Section [PinePhone drivers for audio, camera, and power control].
With the fundamental device drivers for the PinePhone covered, we can
now turn our attention to system-integrative work, ultimately raising the
question of how a Genode-based phone should best present itself to the user.

[image sculpt_pinephone_22_11]
  The forthcoming phone variant of the administrative user interface of
  Sculpt OS.

We take this question as an opportunity for exploration. Similarly to
how the so-called Leitzentrale of [https://genode.org/download/sculpt - Sculpt OS]
provides the user with an administrative view on the system that is separate
from the user-defined desktop runtime, we pursued the division of the phone's
UI into two faces that can be toggled with a simple touch gesture.
The first one accommodates the role of the device as a fixed-function
appliance similar to the functionality of a feature phone whereas the second
one can be shaped entirely by the user. The screenshots above give a glimpse
of the user interface of the appliance side. It covers low-level device
parameters, voice calls, establishing network connectivity, and the
installation and management of the software running on the user-defined side.
One can see several cues from Sculpt OS such as the component graph.

The clear-cut separation of the two roles of the device opens up new ways to
leverage Genode's component architecture. For example, observing that the
appliance role needs only a subset of components, we can orchestrate the
startup of the system such that those components are started first. This way,
the device's basic functions like voice calls become available in under 7
seconds when powering-on the device.

Regarding the built-in feature set, we implemented the fundamental device
functions that everyone takes for granted, like displaying the battery
state, triggering the charging when a charger gets connected, controlling
the brightness of the display, or powering down the device.

The phone variant of Sculpt OS evolves in the
[https://github.com/nfeske/genode-allwinner - genode-allwinner] repository,
specifically within the _sculpt/_ and _src/app/phone_manager/_ directories.
It can be built via the following command:

! built/arm_v8a$ make run/sculpt KERNEL=hw BOARD=pinephone SCULPT=phone

For loading the system on the PinePhone, please follow the instructions given
in the following article.

:Booting Genode on the PinePhone:

  [https://genodians.org/nfeske/2021-09-20-pine-fun-pinephone-boot]

Note that the current version is still at a rather developer-focused stage.
To avoid testimonies of a prematurely released version, we decided to postpone
the release of a ready-to-use image until the feature set generally expected
from a phone is complete and well tested.


ARM virtual machine monitor
===========================

The hardware-assisted virtual machine monitor (VMM) for ARM developed for Genode
resides within the framework since release 15.02. Over the years it got
extended to support recent ARMv8 hardware, VirtIO device models for console,
network, block, and so on. Nevertheless, the given device models, memory
dimensions, and Linux specifics like initramfs size were hard-coded within the
VMM component, and not configureable.

Now, the VMM accepts a configuration that enables you to define various aspects
for the virtual machine, and guest OS. The VMM still focuses on Linux OS guests.
Formerly, a pre-compiled flattened device-tree binary (DTB) was used by the VMM
to boot the Linux guest.  Now the VMM has to generate the DTB dependent on its
own configuration.

An example configuration looks like the following:

! <config kernel_rom="linux"
!         initrd_rom="initrd"
!         ram_size="512M"
!         cpu_count="4"
!         cpu_type="arm,cortex-a53"
!         gic_version="3"
!         bootargs="console=hvc0">
!   <virtio_device name="hvc0" type="console"/>
!   <virtio_device name="eth0" type="net"/>
!   <virtio_device name="hd0"  type="block"/>
! </config>

The RAM size and CPU count attributes are mandatory. All other attributes are
optional and use default values. However, it is noteworthy that you should use
the correct values for CPU type and Generic Interrupt Controller (GIC) version
that matches your underlying hardware. Due to the usage of hardware-dependent
virtualization extensions, the VMM and guest OS should see the correct hardware
description for CPU and interrupt controller.


Seoul VMM
=========

The Seoul/Vancouver VMM - introduced to Genode with release 11.11 - is a
x86 based VMM which runs on Genode@NOVA, Genode@seL4, and Genode@Fiasco.OC on
Intel and on AMD hardware. It is used with 32-bit Linux VMs typically.

Over the last and this year, the VMM got Virtio support with the goal to improve
the usability when used day-to-day, e.g., on Sculpt OS. Given the observation
that most Linux guests come readily (or easy to install) equipped with Virtio
driver support, we can avoid to fiddle with building or integrating guest drivers
manually. The Seoul VMM got extended by implementations for the Virtio input
device model, Virtio GPU device model (2D by now) and Virtio audio device
model.

With the new input model, absolute mouse positions are supported, so
that the mouse pointer positions in Genode's Sculpt OS and in the guest VM
can be kept in sync. Beforehand, it was hardly possible when solely using
the PS/2 model using relative motion vectors.
With the new 2D GPU model, the mouse pointer shape of the guest VM can be
exported and shown by Genode's GUI multiplexer instead of the native mouse
pointer, which improves the visual impression and avoids confusion.
Additionally, with the new GPU model, resizeable and arbitrary resolution
dimension are possible, which was not feasible with the former VGA/VESA model.
The overall painting overhead is better manageable since partial updates are
supported by the device model.
The Virtio audio model enables playback of music when streaming & surfing in
the VM, which was beforehand not possible because no audio model was available.
The new Virtio models of the Seoul VMM were finally mapped to Genode's GUI,
input and audio-out session interfaces.

Combined, the new device models improve the overall usability when using Seoul on Sculpt OS.
Several packages of alex-ab's depot are available to get started, ranging
from a full on target Debian installation over pre-packed and ready to use VMs
to up-to-date Firefox and Thunderbird VMs based on Tiny Core Linux.
Whereas the Firefox VM is entirely disposable - as mentioned in
[https://genodians.org/alex-ab/2019-03-06-disposal-browser-vm] -
the Thunderbird VM relies on persistent storage.


Device drivers
##############

Uniform use of new platform-driver interface
============================================

; @skalk

commit c583446adedccd0ed1dac5e8b3169cc9718983c6
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 9 11:46:27 2022 +0200

    platform_drv: add HDAUDIO PCI quirks
    
    Ref genodelabs/genode#4578

commit 281785f6bd9a7f60dfa3c25af47ff1d2fa27a92c
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Tue Sep 13 14:26:08 2022 +0200

    platform API: make MMIO dataspace cap accessible
    
    In case of the GPU multiplexer, we need to delegate MMIO memory
    to the framebuffer client in form of a managed dataspace. To be
    able to attach a given Platform::Device::Mmio object to a region map
    we need to access its capability.
    
    Ref genodelabs/genode#4578

commit 85dc2e5b9bd55e8b968a3b920e0a62a03982f26e
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Sep 15 11:26:32 2022 +0200

    pci_decode: interpret reserved memory from ACPI
    
    We need the information about reserved memory region reports
    from the ACPI tables within the platform driver to pre-fill
    IOMMU tables with the corresponding mappings. Therefore,
    the pci_decode component now parses the information from the
    ACPI ROM, and adds "reserved_memory" nodes to all related
    devices in the devices report.
    
    Ref genodelabs/genode#4578

commit 5e42f347d89b50dc93a3975395707c8137ae3436
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Sep 15 11:28:29 2022 +0200

    platform_drv: attach reserved memory to device PD
    
    Consumes the information about reserved memory region reports from
    the devices ROM, and adds appropriated mappings to the corresponding
    device PD.
    
    Ref genodelabs/genode#4578

commit 71129fca2d9bd5d5762ead5c2b82c83e039015d0
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Tue May 3 14:02:30 2022 +0200

    nvme_drv: use generic platform API
    
    Ref genodelabs/genode#4578

commit 9f9a5186e0a0877eb7be1d0370863f9ab51f5ea0
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Apr 28 15:56:02 2022 +0200

    ps2_drv: use generic platform API
    
    Ref genodelabs/genode#4578

commit 5528434fb64afe95fe6e6c3fb3baa56cbbc7349c
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Jul 29 17:31:20 2022 +0200

    lx_kit & lx_emul: use generic platform API
    
    * Remove wrapper for legacy x86 platform API
    * Move PCI configuration space quirks to corresponding driver
      (pc_usb_host_drv, pc_wifi_drv, pc_intel_fb_drv)
    * Adapt driver test run-scripts to changed configuration
    
    Ref genodelabs/genode#4578

commit ed8f71e459de2a4fdb664c25711e3b288a53eac1
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Aug 31 11:31:17 2022 +0200

    ahci_drv: use generic platform API
    
    Ref genodelabs/genode#4578

commit 92b5dda2bc944d4bc82f230b67a6a89aa60c49cf
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Aug 31 13:51:10 2022 +0200

    vesa_fb_drv: use generic platform API
    
    Ref genodelabs/genode#4578

commit feaaaa3e8be3b5a2b3f379e2909b8926485c7682
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Aug 31 13:51:54 2022 +0200

    drivers_interactive-pc: use generic platform_drv
    
    Ref genodelabs/genode#4578

commit 7cf6651d2c2f3e746b08aacc56bad1815108db95
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 2 13:35:47 2022 +0200

    ipxe_nic_drv: use generic platform API
    
    Ref genodelabs/genode#4578

commit 8d746a701edbc85cce438f2a6681db52d74b5b6d
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 2 13:37:36 2022 +0200

    drivers_nic-pc: use generic platform_drv
    
    Ref genodelabs/genode#4578

commit 03cec5cdd7be8d5cd3819ae29be9ec3765a68c7f
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 9 11:49:07 2022 +0200

    dde_bsd: use generic platform API
    
    Ref genodelabs/genode#4578

commit 250275fbfbc86afeb6989fb91e3dbac186a631e1
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Tue Sep 13 14:27:24 2022 +0200

    gpu_drv: use generic platform API
    
    Ref genodelabs/genode#4578

commit e7571c539c182da1aa2ef9c80a193c541dcd22d5
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Sep 15 15:12:14 2022 +0200

    sculpt: use generic platform driver
    
    Ref genodelabs/genode#4578

commit c8f055c9e3c3d8ccd132863921bafe2f3a1cf1f3
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Sep 15 16:15:08 2022 +0200

    smbios_decoder.run: remove legacy platform_drv
    
    Ref genodelabs/genode#4578

commit 9b38af4d7dbb866cd213112c6bbec0309f847fa8
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 16 11:51:38 2022 +0200

    smartcard.run: remove legacy platform_drv
    
    Ref genodelabs/genode#4511
    Ref genodelabs/genode#4578

commit 203f24742a45dcabd06cb2a3801a4d261e4796ba
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 16 13:30:25 2022 +0200

    netperf tests: remove legacy platform_drv
    
    Ref genodelabs/genode#4511
    Ref genodelabs/genode#4578

commit 71eefc3315b611cf260806f1cb7c5d5d8d7861a4
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 16 14:05:32 2022 +0200

    nic_router_uplinks.run: remove legacy platform_drv
    
    Ref genodelabs/genode#4511
    Ref genodelabs/genode#4578

commit 91e64c3f27bcb0846b5b3cbcaeb2def915b77d18
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 16 15:17:51 2022 +0200

    vbox5_genode_usb_hid: remove legacy platform_drv
    
    Ref genodelabs/genode#4578

commit b8eab65536ac249c574ddc383cbee20fa02668aa
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 16 15:33:58 2022 +0200

    dde_linux: remove legacy usb_host_drv for x86
    
    Remove legacy platform_session API usage from legacy lx_kit/lx_emul
    
    Ref genodelabs/genode#4578

commit de0c339e0b7a5ca5b8565aabdf2479f2a71cdf13
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 16 15:38:15 2022 +0200

    pci: remove pci test of legacy platform API
    
    Ref genodelabs/genode#4578

commit fdba7259ab07a45240dc0c08eafee7d3e0544907
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Tue Sep 20 12:01:21 2022 +0200

    platform_drv: provide Virtio PCI information
    
    Ref genodelabs/genode#4578

commit ec6f89111ef9c27492b1b9bc9cd8e5c6032fc2d6
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Tue Sep 20 12:02:32 2022 +0200

    virtio_pci: use generic platform API
    
    Ref genodelabs/genode#4578

commit afa0bed5fcd2f6c220cf382eb0c580e90495a924
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Sep 22 09:47:12 2022 +0200

    platform_drv: add USB4 pci class, update README
    
    Ref genodelabs/genode#4578

commit c7c460f6e01c358cd8d334a2790f436251123f78
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Mon Sep 26 15:59:36 2022 +0200

    os: add include/pci/* to os api
    
    Ref genodelabs/genode#4578

commit 7334128a2eaf880454b58b733de1c8db07fd52e6
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Sep 28 13:56:17 2022 +0200

    pci_decode: export prefetchable attribute of BARs
    
    Memory descriptors in PCI BARs have a prefetchable bit, which can
    be used to optimize memory access when setting, e.g. write-combined
    in page-table entries.
    
    Ref genodelabs/genode#4578

commit 6a7247ab443e787d041770e6b40d37e152ce0d3a
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Sep 28 13:59:17 2022 +0200

    platform: remove cache attribute from io_mem call
    
    Instead of allowing the client to set a caching attribute
    in the io_mem() call of the device interface, which was
    only used to decide in between of the memory  being
    write-combined or not, remove it from the API.
    Instead use the information delivered by the devices ROM,
    whether memory from a PCI BAR is prefetchable or not,
    to decide whether it is mapped write-combined or not.
    
    Ref genodelabs/genode#4578

commit b20cabb6e424d1d62b050f5f0351888060ad26d2
Author: Christian Helmuth <christian.helmuth@genode-labs.com>
Date:   Wed Sep 28 17:01:45 2022 +0200

    pci: fix PCIe extended capability definition
    
    Also removed the warning about unhandled capability IDs.
    
    Ref genodelabs/genode#4578

commit 9e33e572945b512c151b3ddcd70eff0f6c8884d4
Author: Alexander Boettcher <alexander.boettcher@genode-labs.com>
Date:   Thu Sep 29 08:09:18 2022 +0200

    nova: support more MSIs
    
    Issue #4578
    
    Ref alex-ab/nova#8

commit 00c9ac363ffb73d128c3f2f5021a08a93dc7b265
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 30 16:19:00 2022 +0200

    platform_drv: add EHCI PCI quirk, apply in order
    
    * Add EHCI PCI quirk
    * Add UHCI reset to UHCI quirk
    * Apply all PCI quirks in order of the PCI bus numbering
      otherwise the machine might stall
    
    Ref genodelabs/genode#4578

commit fa124dd3405767a8c56f49664b26c1a8240d6804
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 30 17:15:32 2022 +0200

    lx_kit: do not close/re-open IRQ session
    
    Instead of dynamically close/open IRQ session whenever an IRQ
    gots masked/unmasked, track the state internally and resp.
    deliver an interrupt delayed.

commit 2ccdbf10507e6db5aaf3d62347b38f68b2cd4ade
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Sep 30 17:17:40 2022 +0200

    platform_drv: implement shared interrupt support
    
    Ref genodelabs/genode#4578

commit 08f1f94fcb7dcdbf6b961c400e02d96b91b248c1
Author: Christian Helmuth <christian.helmuth@genode-labs.com>
Date:   Wed Oct 5 15:04:34 2022 +0200

    pci_decode: IRQ reporting for MSI/MSI-X only devices
    
    Don't skip IRQ reporting if legacy IRQ/GSIs are not supported as the
    device may support MSI/MSI-X exclusively.
    
    The commit also enables reserved_memory reporting of devices without
    IRQs.
    
    Ref genodelabs/genode#4578

commit 243c819257995b683a1629585b983b49d4d7f2f2
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Oct 5 14:57:04 2022 +0200

    pci_decode: use MSI enumerator as function value
    
    Instead of using a global value to enumerate the MSIs, use a function argument
    instead. Whenever the process of PCI device reporting gets started again,
    due to an initially too small report buffer, the MSI enumeration value is reset
    again. Formerly, we wasted MSI numbers.
    
    Ref genodelabs/genode#4628

commit 1504041c82855f27e7956b6f02d9300791f62462
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Oct 5 16:16:27 2022 +0200

    pc_platform_drv: introduce pc-specific driver
    
    This driver observes a "system" ROM, as well as the acpi ROM to implement
    reset functionality.
    
    Ref genodelabs/genode#4578

commit 3841ee1d51fa17d3b8702d43770e90a886e7689d
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Oct 5 18:25:55 2022 +0200

    platform_drv: implement MSI-x support
    
    Ref genodelabs/genode#4578

commit ba97415ef90568c4d31e4893155773d49ba7aa31
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Oct 7 11:17:09 2022 +0200

    pci_decode: prefer MSI over MSI-x
    
    Ref genodelabs/genode#4578

commit e7ba0b7371b6a5d044a575fc92eb504d2a62c6a9
Author: Christian Helmuth <christian.helmuth@genode-labs.com>
Date:   Fri Oct 7 17:10:05 2022 +0200

    pci: initialize BAR config on demand only
    
    On-demand initialization prevents read-write operations on BARs of
    invalid devices at construction time, which may result in surprising
    behavior later on, for example, when resetting X260 notebooks via ACPI
    information.

commit 7f0c89f37839525f53e5b0ce667912f52bee4626
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Fri Oct 7 14:31:42 2022 +0200

    pci_decode: enable all bridges
    
    set I/O port, MMIO, and bus master to enabled for bridges where
    disabled.
    
    issue #4578

commit 8f0a012345652a6c0fedbda085640823497967b7
Author: Alexander Boettcher <alexander.boettcher@genode-labs.com>
Date:   Tue Oct 4 13:21:01 2022 +0200

    acpica: adjust to new platform driver
    
    genodelabs/genode#4578

commit bc1e2317759295b0f921d7d0a55e0c1ab151bbae
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Mon Oct 10 15:17:55 2022 +0200

    platform_drv: implement PCI powering and reset
    
    Ref genodelabs/genode#4578

commit a4206702174574e292ee7e1adfe3363f71d6eadc
Author: Josef SÃ¶ntgen <josef.soentgen@genode-labs.com>
Date:   Fri Oct 7 21:00:10 2022 +0200

    pci_decode: disable MSI on HDAUDIO cards
    
    According to OpenBSD's azalia driver some AMD HDAudio devices do not
    play nice with MSIs although the capability is set. At least the
    0x1457 device was tested and worked using GSIs only.
    
    genodelabs/genode#4578

commit 01e1e4e5b91084b3bf303f9c4ce45a7f44c85964
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Oct 27 14:37:42 2022 +0200

    platform_drv: add "leave_operational" attribute
    
    If a device should not be reset, powered off, and its clocks
    shall stay untouched when it gets released, the leave_operational
    attribute can be set to true in the device node of the related
    device inside the devices ROM delivered to the platform driver.
    This is useful for drivers, which only enable and initialize
    their device, and can be closed afterwards.
    
    Ref genodelabs/genode#4654

commit 1057c7d6a9965a32a477dae8306935787fe93a8b
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Tue Nov 15 15:59:31 2022 +0100

    Remove legacy platform_drv, API, and platform.inc
    
    Fix genodelabs/genode#4671

commit 66491ddba1f6e1d83f88f20522ae081e245f66e7
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Nov 18 13:59:10 2022 +0100

    pci_decode: report devices from ACPI info
    
    Although we do not have the full ACPI information parsed yet, to
    announce non-PCI devices derived from the ACPI tables, the device
    description of the assumed devices is now integral-part of pci_decode.
    Formerly, the information was gained separatedly as boot-module, whereby
    we lost synchronization in between ACPI/PCI parsing, BIOS handover, and
    PS/2 emulation code already acting.

commit 768029398d42485c6fa75ffc3704cf662202a406
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Fri Nov 18 14:11:38 2022 +0100

    pci_decode: increase default ram quota
    
    To circumvent problems of the page-table entries getting short on sel4,
    increase the RAM quota for this component in all run-scripts.
    
    Fix #4686


PinePhone drivers for audio, camera, and power control
======================================================

Over the past 18 months, we have steadily expanded the base of device drivers
for the PinePhone, initially addressing the
[https://genodians.org/nfeske/2021-12-21-pine-fun-display - display] and
[https://genodians.org/nfeske/2022-03-16-pine-fun-touchscreen - touchscreen],
later covering the
[https://genode.org/documentation/release-notes/22.02#PinePhone_modem_access - modem],
[https://genode.org/documentation/release-notes/22.05#Custom_system-control_processor__SCP__firmware - system control],
[https://genode.org/documentation/release-notes/22.08#GPU_and_Mesa_driver_for_Mali-400 - GPU], and
[https://genode.org/documentation/release-notes/22.08#SD-card_driver_for_the_PinePhone - SD-card].
With the current release, we wrap up this line of work with drivers for
audio, camera, and power control.

As a prerequisite step for enabling the camera, we changed the version of
Linux kernel that we use as donor of the driver code. Up to now, we relied on the
vanilla Linux kernel for the Allwinner SoC. However, the camera support still
resides on [https://xnux.eu - Ondrej Jirman's] custom kernel (orange-pi-5.14),
which is apparently the kernel of choice for most Linux distributions for the
PinePhone. We follow suit.


Audio
-----

The added audio support consists of two separate components, namely an
audio-control driver and audio in/out driver. The former controls the audio
routing and mixing on the hardware level. It is responsible to route the mic
to the modem during voice call, control the gain, or enable/disable the
speaker. The privacy-sensitive audio-control driver is meant to be part of the
base system of Sculpt. It operates according to its configuration, which can
be updated dynamically.

Volumes can be configured by nodes within the '<config>' node using a volume
attribute (range 0-100) where 0 implies turning off the input or output
device. Supported nodes are '<mic>', '<speaker>', and '<earpiece>'.
Furthermore, a '<codec>' node can be used to switch the audio path between the
modem and the ARM application processor (SoC). Its 'target' attribute can be
set to either "soc" (default) or "modem". The "soc" mode implicitly sets the
codec's sample rate to 44.1 KHz whereas "modem" mode sets the sample rate to
48 KHz. This distinction is required because the modem is compatible with 8
KHz only. The modem's 8 KHz can be cleanly converted to 48 KHz.

In contrast to the audio-control driver, the audio in/out driver is concerned
with streaming PCM audio data to/from the ARM application processor. It allows
audio applications hosted in the user-defined runtime of Sculpt OS to record
and play audio via Genode's audio-in and audio-out session interfaces.
The combination of both drivers can be exercised via the
[https://github.com/genodelabs/genode-allwinner/blob/master/run/audio_pinephone.run - audio_pinephone.run]
script.


Power control
-------------

The new power-control driver is based on our custom firmware for the A64's
system-control processor (SCP) in combination with Genode's dedicated
scp-session interface that allow Genode components to interact with the SCP.

To properly arbitrate the access to the power-management IC (PMIC) between
the SCP firmware and the ARM application processor, the PMIC driver has been
moved entirely to the SCP side. This way, both the SCP firmware and
Genode-based SCP clients become able to safely access the PMIC without
stepping on each other's toes. In particular, the platform driver acts as an
SCP client to toggle power controls. Since the platform driver now depends
on the SCP, we co-located the formerly separate SCP driver component with the
platform driver.

Built upon this infrastructure, a new power driver exercises control over
several low-level aspects of the PinePhone hardware such as:

* Platform reboot (via the PMIC),
* Powering down the system (via the PMIC),
* Switching between the power profiles "performance" and "economic",
  which clock the ARM CPU at 1296 MHz and 816 MHz respectively,
* Reporting the remaining battery capacity, power draw, or charge current,
* Triggering the charging when connecting a charger, and
* Adjusting the backlight brightness.

Besides being integrated in Sculpt OS, the driver can be exercised in
isolation using the
[https://github.com/genodelabs/genode-allwinner/blob/master/run/power_pinephone.run - power_pinephone.run]
script.


Camera
------

The added camera driver component consists of a port of the Linux SUN6I-CSI as
well as OV5640 and GC2145 drivers. It renders the captured camera image data
into a GUI session according to the following configuration attributes.

The 'camera' attribute selects the camera. Supported values as "front" and "rear".
The 'width' and 'height' attributes select the horizontal and vertical
resolution. Valid configurations are 640x480 as well as 1280x720.
The 'fps' attribute selects the capture rate of the camera. Valid values
are "15" and "30".
The 'format' attribute selects the capture format. The only valid value
is "yuv", which selects YUV420.
The 'convert' attribute specifies if the captured image data is converted
to the pixel format suitable for the GUI display. Default is "true".
The 'rotate' attribute specifies if the capture image data is rotated
counter-clockwise and flipped. Default is 'true'.

The integration of the driver is exemplified by the
[https://github.com/genodelabs/genode-allwinner/blob/master/run/camera_pinephone.run - camera_pinephone.run] script.
The test scenario displays the camera image on the framebuffer. It repeatedly
switches between front and rear camera.


New PCI and network drivers for NXP i.MX
========================================

PCIe host controller for i.MX 8MQ
---------------------------------

The i.MX 8MQ SoC includes two PCI express host controllers. The MNT Reform 2
laptop for example exposes both via one M.2 and one miniPCIe socket, e.g., to
drive a NVMe card and a WiFi card.
In contrast to x86-based PCs, those PCIe controllers are not set up by
boot-firmware like BIOS or UEFI, but needs to be driven by the OS first.
Therefore, this release contains a new PCIe driver for the mentioned SoC. This
driver does not provide a special API. It uses the platform driver to gain the
device resources of the PCIe controller, and enables and configures it
appropriatedly.
Then it parses the PCI config space of the device behind the controller, which
in fact acts as PCI host bridge. The collected device and PCI information are
then exposed via the Report service analoque to the PCI decode component
available for x86. Finally, the platform driver resp. another incarnation of the
platform driver can consume this report as devices ROM, and provide the device
resources to a driver of the PCI device.

In practice, we've tested the PCIe host controller driver in combination with
a NVMe card used in the MNT Reform 2 laptop only. Moreover, it got integrated in
the Sculpt OS for the MNT Reform 2. Therefore, we had to add an i.MX 8MQ specific
driver manager. This management component is able to check for the availability
of a NVMe device, controls driver's lifetime, and block device report assembly
for SD-card and NVMe devices.


FEC Network driver
------------------

There is long-standing support for the Freescale Ethernet Controller (FEC)
within Genode available, supporting a broad range of SoCs from i.MX 53 till
i.MX 8.
But the initial driver port taken from Linux 4.16.3 was running shaky on the
i.MX 8MQ SoC and the i.MX 6 Sabrelite board. Instead of trying to investigate
potential violated semantics in the legacy DDE Linux emulation code, we ported
the Linux device driver for FEC from scratch. Thereby, we've used the recent DDE
Linux porting approach, first described in the 21.08 release.
The Linux kernel code we used therefore is the Linux kernel 5.11 vanilla kernel
plus MNT Reform 2 patches provided by Lukas Hartmann, which we already use for
other drivers available in the genode-imx repository.

To let the driver work correctly, it needs information about its clock
frequencies. Therefore, we have extended the platform driver for i.MX 53, and
introduced new rudimentary platform drivers specific to i.MX 6 and 7, which
expose the needed clock frequencies.


USB-C on i.MX 8MQ EVK
---------------------

The USB host controller driver for the i.MX 8MQ EVK board did not enabled the
second USB host controller yet, which is connected to the USB-C socket of the
board. Now this host controller gets driven too.


Intel graphics
==============

The Intel display driver was enabled to run on Intel Alderlake graphics PCs,
tested on the 12th Gen
[https://frame.work/de/en/products/laptop-12-gen-intel - Framework Laptop].
Furthermore, the driver
supports now 4K displays, tested specifically on Dell Ultrasharp and LG 27MU67
hardware.
Additionally, the driver may now be configured to setup an upper resolution
bound to avoid out-of-service exceptions due to unexpectedly high memory needs.
This feature is used by default
on Sculpt to limit resolutions to WQHD aka 1440p aka 2560x1440 pixels and
can be changed in _repos/gems/sculpt/fb_drv/default_.


Audio driver updated to OpenBSD 7.1
===================================

We updated the audio-driver component to OpenBSD version 7.1 that
brings in support for playback on more recent 12th Gen Intel machines.
Besides the update, we remedied a long-standing shortcoming when
handling multiple HD-Audio devices and removed the support for old
audio devices.

The component contained a simple check to exclude known non-working devices
but depending on the machine's configuration, this check was incomplete. Rather
than extending the check, we took a step back and changed the probing
behavior of the component:

![init -> audio_drv] azalia0 [8086:160c]
![init -> audio_drv] :
![init -> audio_drv] azalia0: no supported codecs
![init -> audio_drv] azalia1 [8086:9ca0]
![init -> audio_drv] :
![init -> audio_drv] azalia1: codecs: Realtek ALC292
![init -> audio_drv] audio0 at azalia1

It now checks all available devices and picks the first
one it can use. This comes in handy in configurations where the virtual
PCI-bus is populated with all audio devices found in a machine and some of
them contain unsupported codecs as, among others, found on GPUs.

Furthermore, we decided to remove the _eap_ and _auich_ drivers as these drivers
rely on I/O port access, which still had to be enabled in the component after
the switch to the new platform driver and due to being of minor importance in
daily use.
The first one was mainly used to initially develop the component and later on
for testing in QEMU. The second one on the other hand was merely enabled to
provide a shot at getting audio in VirtualBox VMs where the component did not
work with the HDA device model at the time.


Improved ACPICA driver
======================

The ACPICA driver got improved support for Thinkpad notebooks to report ACPI
events and in particular battery state changes. The frequency of checking of
state changes, which are not triggered by an ACPI event, can now be configured
explicitly, which is documented in the README file of the component.

Additionally, the ACPICA component got extended to support ACPI suspend & resume
functionality. On the one hand the component can be configured to determine and
report the supported ACPI sleep states (S1-S5) of a PC machine. On the other
hand, the component can now react on 'system' ROM changes and participate on
sleep state preparation and the subsequent wakeup procedure using the ACPICA library,
e.g., AcpiEnterSleepStatePrep, AcpiLeaveSleepStatePrep and AcpiLeaveSleepState.


Wireless-networking improvements
================================

In the process of enabling the Intel AX211 wifi card, DDE-Linux and the wifi
driver were enhanced to support loading PNVM firmware files. Ultimately, a
[https://github.com/QubesOS/qubes-linux-kernel/commit/5fcfe0f19ed5ff2bd3514644afce0af642c326c6 - workaround]
from QubesOS was needed to make the card work, highlighting shared challenges
that both our projects face when using Linux drivers in unconventional ways to
improve system security.


Platforms
#########

Low-level mechanism for suspend/resume on PC platforms
======================================================

On modern PC platforms, suspend and resume is realized by using a mechanism
provided by ACPI. The Advanced Configuration and Power interface defines
(beside many other things) several global states (Gx) and six sleep states (Sx)
an operating system (OS) can choose. Oversimplified, the S0 state is the
normal working state, S1-S2 are light sleeping states, S3 is known as
"suspend to RAM" state, S4 is called "suspend to disk" and S5 is mostly "off".
See [https://en.wikipedia.org-wiki/ACPI#OSPM_responsibilities] for a basic
overview and further pointers for reading.

The supported sleep states varies between PCs, some of which not even support
all states. An operating system has to lookup and determine the supported Sx
states, which are part of ACPI tables and ACPI AML code. Beginning with this
Genode release, we can use the ACPICA driver to lookup the supported Sx states.
The sleep states themselves are represented as two values
(TYP_SLPa and TYP_SLPb in ACPI specification) and are reported by the ACPICA
driver.

In order to trigger/program the intended sleep state, an OS like Genode + used
kernel has to look up and setup several ACPI tables, e.g., FACS & FADT. Via the
tables, the OS deposits a wakeup vector, which is called by the UEFI firmware on
wakeup. Before going to sleep actually, the OS has to take care to flush all
kinds of hardware cached state either to memory or persistence storage,
depending on the Sx state.

With this release, we added principal support for S3 "suspend to RAM" for
Genode using the NOVA kernel. The kernel supports now
a privileged suspend syscall, which is solely available to Genode's core
roottask. The invocation is triggered and guarded by Genode's
'Pd::managing_system' RPC function,
which takes both TYPE_SLPa and TYP_SLPb values as parameters representing
the intended Sx state. On invocation, Genode's core will check that the component
holds Genode's managing-system capability. On success, the suspend syscall
of the NOVA kernel is invoked and will lead to hold all CPUs, depositing the
wakeup vector in the ACPI tables, flushing cached state of Genode's
components to memory, like CPU registers, FPU state, IO-APIC state and
virtualisation state of Intel VMX's or AMD SVM's. Finally, the both TYP_SLP
values will be used to trigger the sleep state.

On ACPI wakeup, the UEFI/BIOS firmware wakes up the NOVA kernel via the
deposited wakeup vector. The kernel re-initializes the CPU and
wakes up all other CPUs. Finally, control will be transferred to Genode's
roottask (core), which than can thereby return from the 'Pd::managing_system'
RPC call.

Before and after the actual suspend and resume, the ACPICA driver should
be used to run ACPI AML methods to prepare and post process the system state
change, which may effect the success of the Sx state transfer depending on the
used PC platform. Additionally, after resume, all hardware and their drivers
must be considered to be re-initialized. The re-initialization and re-starting
of drivers and hardware, e.g., PCI, is not finished currently.

An early prototype for exercising this scenario is available in the form of
the _acpi_suspend.run_ script in the _libports_ repository. This test scenario
periodically suspends and resumes the hardware and also restarts the used
display driver. The low level ACPI suspend and resume can be observed to work
quite reliable, which we could validate across several generations of Intel
notebooks and some AMD desktop machines. However, the re-starting of the
display driver is not always reliable. Restarting the Intel display driver
worked notably well on older Thinkpad notebooks, e.g., X201 and T420.

This work is still work in progress. The next potential work items consist
of adding support to suspend and resume also the base-hw kernel, ways to
power-off and power-on (PCI) hardware, e.g., via the new platform driver and
re-initializing and/or re-starting drivers. Additionally, a convenient way to
debug resume issues is desired when no serial output is working anymore after
resume.


Base-HW microkernel
===================

The base-hw kernel, which was developed directly for Genode, did not provided
the usage of Message-Signaled-Interrupts (MSI), and MSI-x yet. With this release
x86 architectural support for MSI and MSI-x entered the base-hw kernel.
The usage of MSI or legacy interrupts is transparent to the user. It gets
determined in the interplay of the PCI decode component, platform driver, and
core.


NOVA microhypervisor
====================

Besides the added ACPI suspend/resume support described in
Section [Low-level mechanism for suspend/resume on PC platforms],
the kernel received principal support to run on more than 32 CPUs. By
default, Genode's and the kernel's CPU limit is set to 64, configurable by
the constants MAX_SUPPORTED_CPUS in Genode's core respectively NUM_CPU in the
kernel. According to our tests, up to 250 CPUs were usable in Qemu.


Build system and tools
######################

Streamlined building of libraries
=================================

The release adds special handling for 'lib/<libname>' arguments to the
build system, which supersedes the former 'LIB=<libname>' mechanism.
Whereas the old mechanism was limited to a single library, the new
convention allows multiple library arguments, similar to regular
targets.

The change brings the two immediate benefits. First, the streamlining of
library and target arguments allows for the building of libraries via the
'build' command of the run tool. Second, it alleviates the need for pseudo
_target.mk_ files for building shared libraries that have no direct
dependencies, in particular VFS plugins.

Note that _target.mk_ files located under _src/lib/_ are no longer reachable.
Therefore, all run scripts that used to trigger the build of a shared library
via a pseudo target must be adapted. E.g., 'build lib/vfs/tap' must be
replaced by 'build lib/vfs_tap'.

The former 'LIB=<libname>' option is no longer supported.


Boot-loading over HTTP
======================

The standard network-boot approach for x86 at Genode Labs has been a
combination of the PC-integrated Preboot Execution Environment (PXE), the
Pulsar boot loader, and the TFTP protocol for years. Because Pulsar is tight
to legacy BIOS interfaces, UEFI-only hardware demands for alternatives. iPXE
is a field-tested, UEFI-compatible alternative that is already supported in
Genode's run tool via _load/ipxe_.

One of the prominent features of iPXE is the support for additional network
(boot) protocols beyond TFTP with HTTP as a tempting option to improve boot
performance. This release enhances the _load/ipxe_ run module to optionally
configure and spawn the lightweight HTTP server _lighttpd_ to serve the boot
image to iPXE using the following declarations in _etc/build.conf_.

! RUN_OPT += --include load/ipxe
! RUN_OPT +=   --load-ipxe-base-dir /tftpboot
! RUN_OPT +=   --load-ipxe-boot-dir /ipxe
! RUN_OPT +=   --load-ipxe-lighttpd
! RUN_OPT +=   --load-ipxe-lighttpd-port 2209

The HTTP server is run only while the run tool is executed, killed on exit,
and limited to serve the contents of the test-specific directory under
*var/run/* in your build directory. Your iPXE boot loader should be
configured to chain the automatically generated _boot.cfg_ file
as follows.

! #!ipxe
! chain http://<host ip address>:2209/boot.cfg

For more details, please refer to the dedicated Genodians.org article.

:Getting Fujitsu U7411 up and running - Network Boot:

  [https://genodians.org/chelmuth/2022-11-24-u7411-up-and-running]


Configurable Intel HWP mode
===========================

We updated our version of the Bender chain-boot loader to be configurable regarding the mode, in which
to run Intel's Hardware P-States (HWP). When running Genode on NOVA, The HWP
mode can now be controlled via the new run option '--bender-intel-hwp-mode'.
The option responds to the values 'off', 'performance', 'balanced', and
'power_saving'. The default value is 'performance' in order to stay backwards
compatible. On kernels other than NOVA, HWP remains turned off in general.
