

              ===============================================
              Release notes for the Genode OS Framework 24.11
              ===============================================

                               Genode Labs



; intro
; @nfeske


New "Genode Applications" book
##############################

Complementary to our _Genode Foundations_ and _Genode Platforms_ books, we have
been working on a new book that concentrates on application development.
The _Genode Applications_ book centers on the Goa SDK that we introduced with
[https://genode.org/documentation/release-notes/19.11#New_tooling_for_bridging_existing_build_systems_with_Genode - Genode 19.11]
and which has seen significant improvements over the past year (
[https://genode.org/documentation/release-notes/23.08#Goa_tool_gets_usability_improvements_and_depot-index_publishing_support],
[https://genode.org/documentation/release-notes/24.02#Sculpt_OS_as_remote_test_target_for_the_Goa_SDK - 24.02],
[https://genode.org/documentation/release-notes/24.08#Goa_SDK - 24.08]).

The book intends to provide a beginner-friendly starting point for application
development and porting for Genode and Sculpt OS in particular.
It starts off with a getting-started tutorial for the Goa tool. It
further recapitulates Genode's architecture and a subset of its
libraries, components and conventions such as the C runtime, VFS, NIC router and
package management. With these essentials in place, the book is topped off with
instructions for application debugging and a collection of advanced tutorials.

Aligned with the release of Sculpt 24.10, we updated the Goa tool with the
corresponding depot archive versions. Furthermore, the Sculpt-integrated and
updated _Goa testbed_ preset is now prepared for remote debugging.

: <div class="visualClear"><!-- --></div>
: <p>
:  <div style="clear: both; float: left; margin-right:20px;">
:   <a class="internal-link" href="https://genode.org">
:    <img class="image-inline" src="https://genode.org/documentation/genode-applications-title.png">
:   </a>
:  </div>
: </p>

:First revision of the Genode Applications document:

  [https://genode.org/documentation/genode-applications-24-11.pdf]


Multi-monitor support
#####################

Among the users of the Genode-based Sculpt OS, the flexible use of multiple
monitors was certainly the most longed-after desire raised during our public
road-map discussion roughly one year ago. We quickly identified that a
profound solution cannot focus on piecemeal extensions of individual
components but must embrace an architectural step forward. The step turned
out being quite a leap.
In fact, besides reconsidering the roles of display and input drivers in
[https://genode.org/documentation/release-notes/20.08#The_GUI_stack__restacked - version 20.08],
the GUI stack has remained largely unchanged since
[https://genode.org/documentation/release-notes/14.08#New_GUI_architecture - version 14.08].
So we took our multi-monitor ambitions as welcome opportunity to incorporate
our experiences of the past ten years into a new design for the next ten
years.


Tickless GUI server and display drivers
=======================================

Up to now, the nitpicker GUI server as well as the display drivers used to
operate in a strictly periodic fashion. At a rate of 10 milliseconds, the GUI
server would route input events to the designated GUI clients and flush
graphical changes of the GUI clients to the display driver.
This simple mode of execution has benefits such as the natural ability of
batching input events and the robustness of the GUI server against overload
situations. However, in Sculpt OS, we observed that the fixed rate induces
little but constant load into an otherwise idle system, rendering
energy-saving regimes of modern CPUs less effective.
This problem would become amplified in the presence of multiple output channels
operating at independent frame rates. Moreover, with panel self-refresh
support of recent Intel graphics devices, the notion of a fixed continuous
frame rate is antiquated.

Hence, it was time to move to a tickless GUI-server design where the GUI
server acts a mere broker between events triggered by applications (e.g.,
pushing pixels) and drivers (e.g., occurrence of input, scanout of a display).
Depending on the behavior of its clients (GUI applications and drivers alike),
the GUI server notifies the affected parties about events of interest but
does not assert an active role.

For example, if a display driver does not observe any changed pixels for 50
ms, it goes to sleep. Once an application updates pixels affecting a display,
the GUI server wakes up the respective display driver, which then polls the
pixels at a driver-defined frame rate until observing that the pixels remain
static for 50 ms. Vice versa, the point in time when a display driver requests
a pixel update is reflected as a sync event to GUI applications visible on
that display, enabling such applications to synchronize their output to the
frame rate of the driver. The GUI server thereby asserts the role of steering
the sleep cycles of drivers and applications. Unless anything happens on
screen, neither the GUI server nor the display driver is active. When two
applications are visible on distinct monitors, the change of one application
does not induce any activity regarding the unrelated display. This allows for
scaling up the number of monitors without increasing the idle CPU load.

This change implies that the former practice of using sync signals as a
time source for application-side animation timing is no longer viable.
Sync signals occur only when a driver is active after all. GUI applications
need to use a real time source as basis for animation timing instead.


Paving the ground for tearing-free motion
=========================================

Tearing artifacts during animations are rightfully frowned upon. It goes without
saying that we strive to attain tearing-free motion in Genode. Two
preconditions must be met. First, the GUI server must be able to get hold
of a _consistent_ picture at any time. Second, the flushing of the picture
to the display hardware must by timed with _vsync_ of the display.

Up to now, the GUI stack was unable to meet the first precondition by design.
If the picture is composed of multiple
clients, each client must be present in a consistent state.
The textures used as input of the compositing of the final picture
are buffers shared between server and client. Even though clients employed
double-buffering to hide intermediate drawing states, the final back-to-front
copy into the shared buffer violated the consistency of the buffer during
the client-side copy operation, when looking at the buffer from the server
side. To overcome this deficiency, we have now equipped the GUI server with
atomic blitting and panning, which support atomic updates in two fashions.

_Atomic back-to-front blitting_ allows GUI clients that partially update their
user interface like regular application dialogs to implement double buffering
by placing both the back buffer and front buffer within the GUI session's
shared buffer and configuring a view that shows only the front buffer. The new
blit operation ('Framework::Session::blit') allows the client to atomically
flush pixels from the back buffer to the front buffer.

_Atomic buffer flipping_ allows GUI clients that always update all pixels like
a media player or a game to leverage panning ('Framework::Session::panning')
to atomically redirect the displayed pixels to a different portion of the GUI
session's shared buffer. This buffer contains two frames, the displayed one
and the next one. Once the next frame is complete, the client changes the
panning position to the portion containing the next frame.

Almost all GUI clients of the Genode OS framework have been updated to use
the new facilities.

The vsync timing as the second precondition for tearing-free motion lies in
the hands of the display driver, which can in principle capture pixel updates
from the GUI server driven by vsync interrupts. In the presence of multiple
monitors with different vsync rates each, a GUI client may deliberately select
a synchronization source ('Framebuffer::Session::sync_source'). That said,
even though the interfaces are in place, vsync timing is not yet provided by
the current display drivers.


Mirrored and panoramic monitor setups
=====================================

A display driver interacts with the nitpicker GUI server as a capture client.
Up until now, the nitpicker GUI server handed out the same picture to each
capture client. So each client obtained a mirror the same picture. By
subjecting each client to a policy defining a window within a larger panorama,
a driver creating one capture session per monitor becomes able to display the
larger panorama spanning the connected displays. The assignment of capture
clients to different parts of the panorama follows Genode's established
label-based policy-selection approach as explained in the
nitpicker
[https://github.com/genodelabs/genode/blob/master/repos/os/src/server/nitpicker/README - documentation].

Special care has been taken to ensure that the pointer is always visible. It
cannot be moved to any area that is not captured. Should the only capture
client displaying the pointer disappear, the pointer is warped to the center
of (any) remaining capture client.

A mirrored monitor setup can in principle be attained by placing multiple
capture clients at the same part of nitpicker's panorama. However, there is
a better way: Our Intel display-driver component supports both discrete and
merged output channels. The driver's configuration subsumes all connectors
listed within a '<merge>' node as a single encompassing capture session at the
GUI server. The mirroring of the picture is done by the hardware. Each
connector declared outside the '<merge>' node is handled as a discrete capture
session labeled after the corresponding connector. The driver's
[https://github.com/genodelabs/genode/blob/master/repos/pc/src/driver/framebuffer/intel/pc/README - documentation]
describes the configuration in detail.


Sculpt OS integration
=====================

All the changes described above are featured in the recently released
Sculpt OS version 24.10, which gives the user the ability to attain mirrored
or panoramic monitor setups by the means of manual configuration or by using
interactive controls.

[image sculpt_24_10_intel_fb]

You can find the multi-monitor use of Sculpt OS covered by the
[https://genode.org/documentation/articles/sculpt-24-10#Multi-monitor_support - documenation].


Revised inter-component interfaces
==================================

Strict resource partitioning between GUI clients
------------------------------------------------

Even though Genode gives server components the opportunity to operate on
client-provided resources only, the two prominent GUI servers - nitpicker and
the window manager (wm) - did not leverage these mechanisms to full extent. In
particular the wm eschewed strict resource accounting by paying out of its own
pocket. These deficiencies have been rectified by the current release, thereby
making the GUI stack much more robust against potential resource
denial-of-service issues. Both the nitpicker GUI server and the window manager
now account all allocations to the resource budgets of the respective clients.
This change has the effect that GUI clients must now be equipped with the
actual cap and RAM quotas needed.


Structured mode information for applications
--------------------------------------------

Up to now, GUI clients were able to request mode information via a plain
RPC call that returned the dimensions and color depth of the display.
Multi-monitor setups call for more flexibility, which prompted us to
replace the mode information by XML-structured information delivered as
an 'info' dataspace. This is in line with how meta information is handled
in other modern session interfaces like the platform or USB sessions.

This new representation gives us room to annotate information that could
previously not exposed to GUI clients, in particular:

* The total panorama dimensions.
* Captured areas within the panorama, which can be used by multi-monitor
  aware GUI clients as intelligence for placing GUI views.
* DPI information carried by 'width_mm' and 'height_mm' attributes.
  This information is defined by the display driver and passed to the GUI
  server as 'Capture::Connection::buffer' argument.
* The closed state of a window interactively closed by the user.

Note that the wm virtualizes the information of the nitpicker GUI server.
Instead of exposing nitpicker's panorama to its client, the wm reports
the screen hosting the client's window as panorama and the window size as
a single captured rectangle within the panorama.


Mouse grabbing
--------------

Up to now, GUI clients observed absolute pointer positions only. The nitpicker
GUI server unconditionally translated relative mouse-motion events to absolute
motion events. To accommodate applications like games or a VM emulating a
relative pointer device, we extended the GUI server(s) with the ability
to (selectively) expose relative motion events
while locking the absolute pointer position. This is usually called pointer
grabbing. It goes without saying that the user must always retain a way to
forcefully "ungrab" the pointer without the cooperation of the application.

The solution is the enhancement of the Input::Session interface by a new RPC
function that allows a client to request exclusive input. The nitpicker GUI
server grants this request if the application owns the focus. In scenarios
using the window manager, the focus is always defined by the wm, which also
intercepts all input sessions of GUI applications. Hence the wm is in the
natural position of arbitrating the grabbing/ungrabbing of the pointer. For
each GUI client, the wm records whether the client is interested in exclusive
input but does not forward this request to nitpicker. Only if a GUI client
receives the focus and has requested exclusive input, the wm enables exclusive
input for this client at nitpicker when observing a mouse click. Whenever the
user presses the global wm key (super), the wm forcefully releases the
exclusive input at nitpicker until the user clicks into the client window the
next time.

While operating in exclusive input mode, there is no useful notion of an
absolute pointer position at the nitpicker GUI server. Hence, nitpicker
hides GUI domains that use the pointer position as coordinate origin.
Thereby, the mouse cursor automatically disappears while the pointer is
grabbed.


Current state and ongoing work
==============================

All the advances described above are in full effect in the recently released
version 24.10 of [https://genode.org/download/sculpt - Sculpt OS]. All
components hosted in Genode's main and world repositories have been updated
accordingly, including Genode-specific components like the widget toolkit
used by Sculpt OS, over Qt5 and Qt6, to SDL and SDL2.

Current work is underway to implement multi-monitor window management and make
multiple monitors available to guest OSes hosted in VirtualBox.


Device drivers and platforms
############################

Linux device-driver environment (DDE)
=====================================

With our
[https://genode.org/documentation/release-notes/24.08#Linux_device-driver_environment__DDE_ - recent]
update of the DDE Linux kernel to version 6.6 for PC platforms and as a
prerequisite to support the MNT Pocket Reform (Section [MNT Pocket Reform]), we
have adapted all i.MX drivers for the i.MX8MQ and i.MX5/6/7 platforms to Linux
kenrel version 6.6.47. The list of drivers includes Wifi, Nic, display, GPU, USB
and SD-card.


MNT Pocket Reform
~~~~~~~~~~~~~~~~~

The [https://shop.mntre.com/products/mnt-pocket-reform - MNT Pocket Reform] is a
Mini Laptop from MNT and aims to be modular, upgradable, and repairable while
being assembled completely using open-source hardware. Being modular implies
that a range of CPU modules is available for the MNT Pocket. Some of these
chips, like the Rockchip based modules, are not officially supported by Genode,
yet. But there is a choice of an i.MX8MP based module available which fits
nicely into Genode's i.MX infrastructure.

;; das i.MX8MP module scheint es nicht mehr zu geben

Genode already supports the MNT Reform 2 i.MX8MQ based 
[https://genodians.org/skalk/2020-06-29-mnt-reform - laptop]. So an update from
MQ to MP doesn't sound like a big issue because only one letter changed, right?
It turns out that there are more changes to the platform than mere adjustments of
I/O resources and interrupt numbers. Additionally, the MNT Reform team offers
quite a large patch set for each supported Linux kernel version. Luckily there
is
[https://source.mnt.re/reform/reform-debian-packages/-/tree/main/linux/patches6.6?ref_type=heads - one]
for our just updated Linux 6.6 kernel.  With this patch set we were able to
produce a Linux source tree (imx_linux) that we used as a base for driver
development on Genode. Note that these Linux kernel sources are shared by all
supported i.MX platforms.

With the development environment in place and lots of effort put into, we were
able to implement initial Genode support for the MNT Pocket Reform on Genode
24.11.

For low level device-resource management it was necessary to add an i.MX8MP
specific platform driver for clocks, IRQs, power-domains, etc., that was kindly
provided by Alice Domage. On the device driver front we did not have to port new
drivers, but were able to extent drivers ported for the i.MX8MQ platform.
Working drivers at the moment are: Wifi, network card, USB host controller,
display driver, and SD card.
;; fehlt einer?

Because this is an initial release there are still some issues to be resolved.
For example, the display of the MNT Pocket is physically
[https://mntre.com/documentation/pocket-reform-handbook.pdf - rotated] by 90
degrees. So, we had to find a way to rotate the Genode GUI 90 degrees
counterclockwise. Unfortunately, there seems to be
no hardware support, other than the GPU, to perform a fast rotation. Because GPU
support is still missing we had to resort to software rotation, which is
obviously far from optimal.
;; mehr War Stories hier ...
;; ....

With all this in mind we are happy to announce basic Sulpt OS support for the
MNT Pocket Reform and wish you "Happy Sculpting".
;; oder ne?



commit 298636ff5855b54f491507e79fae45b6009c70f6
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Aug 28 15:35:38 2024 +0200

    imx_linux: update port to Linux 6.6
    
    * Update to Linux vanilla kernel source 6.6.47
    * Only use MNT pocket/reform patches not touching DTS files
    * Add pre-processed DTS files for MNT reform2,
      MNT pocket, and Compulab IOT Gateway
    
    issue genodelabs/genode#5264

commit 443ae50508ca0c7b6411c87740b6a8d33687374b
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Aug 28 15:39:37 2024 +0200

    imx_linux: add support for MNT pocket

commit c208df23a10414da804a083eecfd55da32dd4fc1
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Wed Sep 4 11:21:57 2024 +0200

    imx_linux/arm_v8: enable USBNET for module init hook
    
    Enable USB_USBNET to have 'usbnet_init' module init hook for host driver.
    
    issue genodelabs/genode#5264

commit 366cc191f89e0acd1dbe5db78130b4be2a809520
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Tue Sep 3 13:05:40 2024 +0200

    lx_emul: adjust initcall_order.h to Linux 6.6
    
    Update initcall_order.h headers.
    
    issue genodelabs/genode#5264

commit 77601164787934288ff7a6d4d1a0f56e4f0c44ae
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Tue Oct 1 11:56:33 2024 +0200

    linux-firmware: add QCA9377 FW (MNT Pocket Reform)
    
    Issue #5360.

commit 8d76eebf937408dbd0329d2c2abff1ab3991c54f
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Fri Oct 11 13:30:14 2024 +0200

    sculpt: add MNT Pocket Reform
    
    Fix genodelabs/genode#5360.

commit a4d497cefa2a4bf360a9e9989a500e9e0f1b01d4
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Tue Sep 3 13:48:07 2024 +0200

    driver/usb_host: update to Linux 6.6
    
    * use Linux SLUB-allocator
    * add gpcv2 platform_driver for for driver matching (power-domain)
    * use common_dummies.c
    
    issue genodelabs/genode#5264

commit e8a8e5e1dd6bab66d1ec22c30c40b64fc9490cdc
Author: Alice Domage <alice.domage@gapfruit.com>
Date:   Thu Jul 18 14:39:36 2024 +0200

    platform/imx8mp: add usb related clocks and iomux
    
    This commits adds new clock definitions according to clk-imx8mp.c from
    Linux. Unfortunately, it seems this clocks were not documented in the
    i.MX 8M Plus reference manual. They were discovered in Linux, while
    investigating for imx8mp USB support.
    
    issue genodelabs/genode#5264

commit 9cf688615fd1281bbc8e4fbcd884d1f35ebe5aa3
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Tue Sep 10 20:00:11 2024 +0200

    imx_linux: add USB support for i.MX8MPlus
    
    Update kernel configuration and inticall_order.h for arm_v8a.
    
    issue genodelabs/genode#5264

commit a9a263387ac045cff8f98e26294f1dd62cd37768
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Tue Sep 10 20:03:34 2024 +0200

    lx_emul: add MNT Pocket Reform dts
    
    issue genodelabs/genode#5264

commit 71ac51e9fc5a9551dc10596558c068fa161778bb
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Tue Sep 10 19:54:43 2024 +0200

    usb_host/imx8mq: enable imx8mp
    
    * add basic support for i.MX8MPlus
    * add MNT pocket reform
    
    issue genodelabs/genode#5264

commit 81bf25740fcee979f7ee705ef2287fdb90cf8f55
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Tue Sep 10 20:05:01 2024 +0200

    mnt_pocket: recipes and board files for USB
    
    The 'board' USB configuration is based on commit "usb_host/imx8mq: add
    support for imx8mp_iot_gate" by Alice Domage. Many thanks!
    
    issue genodelabs/genode#5264

commit 402bb2ea23209836b6052f8e51d01540ef95dacf
Author: Alice Domage <alice.domage@gapfruit.com>
Date:   Thu Jul 18 14:43:30 2024 +0200

    usb_host/imx8mq: add support for imx8mp_iot_gate
    
    issue genodelabs/genode#5264

commit 39ec367113872bcb4502151302e9e2b21c44e70c
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Wed Sep 11 10:03:42 2024 +0200

    platform/imx8mp: service watchdog timer
    
    Once the watchdog timer is enabled (e.g., by the boot loader) it cannot
    be stopped. In order to not trigger a sytem reset when the watchdog
    fires, we have to write a service sequence upon a watchdog-timer
    interrupt (default is 2s before timeout). We only enable this behavior
    if the watchdog timer is already running.
    
    issue genodelabs/genode#5264

commit dc691fd163892adcead0adbecdbcce864c478d96
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Sep 11 11:21:18 2024 +0200

    imx_linux: enable efuses for ARMv7, needed for FEC
    
    issue genodelabs/genode#5264

commit 6923307a2c08295fc50e1ed42a76b3a751215e71
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Sep 11 11:25:16 2024 +0200

    driver/nic/fec: update to Linux 6.6
    
    * use Linux SLUB-allocator
    * use pseudo pinctrl and nvmem driver for all architectures now
    * use common_dummies.c
    
    issue genodelabs/genode#5264

commit 7f157437f7673de595467b9746d56d6894dc3ceb
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Sep 11 13:38:35 2024 +0200

    driver/nic/stmmac: update to Linux 6.6
    
    * use Linux SLUB-allocator
    * use common_dummies.c
    
    issue genodelabs/genode#5264

commit f835cce2814c3736f9024867b31e7214289a2a84
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Wed Sep 11 15:43:44 2024 +0200

    driver/sd_card/imx8mq: update to Linux 6.6
    
    * use Linux SLUB-allocator
    * use common_dummies.c
    
    issue genodelabs/genode#5264

commit b2112e427cd9a761983a8fc3620c6d1f4bda8fe5
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Sep 12 16:49:41 2024 +0200

    lib/imx8mq_wifi: update to Linux 6.6
    
    * use Linux SLUB-allocator
    * use common_dummies.c
    
    issue genodelabs/genode#5264

commit 2b3e3e32c6dc07a212a8852e0ba8d06e1bb3599f
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Sep 12 17:31:01 2024 +0200

    driver/gpu/imx8mq: update to Linux 6.6
    
    * use Linux SLUB-allocator
    * use common_dummies.c
    
    issue genodelabs/genode#5264

commit 51388814a7612e9e76b0aed5b5324b8c13155f38
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Thu Sep 12 19:39:04 2024 +0200

    usb_host: rename imx8mq to imx8m
    
    Since now imx8mq and imx8mp are supported rename the driver and all
    occurences to imx8m.
    
    issue genodelabs/genode#5264

commit 59f7209c2bb2cdd21c7ca19fd14584ec1f05e786
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Fri Sep 13 13:58:27 2024 +0200

    framebuffer/imx8mq: update to Linux 6.6
    
    * use Linux SLUB-allocator
    * use common_dummies.c
    
    issue genodelabs/genode#5264

commit ddaf5a35faee28db1b0468873d36f81611f8a796
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Fri Sep 20 13:54:45 2024 +0200

    imx_linux: add support for MNT Pocket Reform LCD
    
    * enable features in target.inc
    * patch the reform/0001-panel-jdi-lt070me05000-pocket-reform.patch
      (changes from linux-mnt-6.6.15)
    
    genodelabs/genode#5360

commit bc59d8f3b3c27de4a52fd4b1009c8cab08b99435
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Tue Oct 1 13:28:19 2024 +0200

    linux-imx: add qcacld-2.0 driver
    
    This commit adds the external 'qcacld-2.0' kernel driver for Qualcomm
    Atheros wireless devices to linux-imx.
    
    Issue genodelabs/genode#5360

commit 7ff14200fffb08ee287fc6f97962f1e0fa570b6a
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Mon Sep 23 18:02:41 2024 +0200

    board/mnt_pocket: add wifi related device
    
    Add the device necessary to use the QCA9377
    based wireless device via SDIO found in the MNT Pocket Reform.
    
    Issue genodelabs/genode#5360

commit 226a45cc91482e88b6905d8e2f466e16781c8f83
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Mon Sep 23 18:03:36 2024 +0200

    Add imx8mp_qcacld2_wifi driver
    
    This commit adds the wifi driver for the QCA9377 as found in the
    MNT Pocket Reform.
    
    Issue genodelabs/genode#5360

commit a29916409d35d7dcfa745eb7ffb64cc83b13bfc9
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Wed Sep 25 17:54:37 2024 +0200

    board/mnt_pocket: add display devices
    
    issue genodelabs/genode#5360

commit 28175a6146c0f64fe3406e0799495a56b731bcf0
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Fri Oct 11 10:58:28 2024 +0200

    sd_card/imx8mq: add MNT Pocket Reform support
    
    Issue genodelabs/genode#5360.

commit 33524f5b91d8a8fd5c43e5ecc62539a017c5b67f
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Thu Oct 24 15:40:59 2024 +0200

    imx8mp: add missing clocks, keep sys_pll3
    
    * Add missing root clocks
    * Do not disable system_pll3, it is used implicitely by one
      of the root-clocks enabled by default
    
    Issue genodelabs/genode#5360.

commit b47370f5c3778fde54dfbf369508a1d1213b206a
Author: Sebastian Sumpf <sebastian.sumpf@genode-labs.com>
Date:   Thu Oct 24 07:14:14 2024 +0200

    framebuffer/imx8mq: add rotation for mnt_pocket
    
    The MNT Pocket Reform display is build into the case with the left
    side up. Therefore, we need to rotate the picture 90 degrees
    counterclockwise on Sculpt.
    
    features/limitations:
    
    * rotate pixel while blitting (pixel by pixel -> slow)
    * switch width and height of capture area
    * use clipping provided by Capture session
    * avoid unnecessary multiplications
    * use device tree in order to determine if we are on MNT Pocket Reform
    
    issue genodelabs/genode#5360

commit 3dcf11a4458b292d6611b7069ea1cc2a0540eb91
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Tue Oct 29 15:19:34 2024 +0100

    mnt_pocket: set CPU frequency to 1.8 GHz on boot
    
    Issue genodelabs/genode#5360

commit cf84787c09d2ffd076d7b8037c1bec1ecdd61418
Author: Stefan Kalkowski <stefan.kalkowski@genode-labs.com>
Date:   Tue Oct 29 15:49:51 2024 +0100

    sculpt_image: add MNT Pocket as target board
    
    Issue genodelabs/genode#5360.

commit d515b5543266f814f9816b6a623e8fb9ff7cd7d7
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Fri Nov 15 11:12:36 2024 +0100

    sculpt_manager: start fb on second CPU on Pocket
    
    With this commit the fb driver is started on the second CPU on the
    MNT Pocket Reform to decouple it from the other components started
    on the first CPU during the system's boot-up and mitigates bring-up
    issues with this driver that result in an often non-working display.
    
    Issue #5378.


Wifi management rework
======================

Our management interface in the wifi driver served us well over the years
and concealed the underlying complexity of the wireless stack. At the same
time it gained some complexity itself to satisfy a variety of use-cases.
Thus, we spent some time in the last release cycle and reworked the management
layer to reduce this complexity by streamlining the interaction between the
various parts, like the manager layer itself and 'wpa_supplicant' as well as
the device driver, and to provide a more sound foundation for future
adaptions.

Included is also the update of the 'wpa_supplicant' to version 2.11.

The following segments detail the changes made to the configuration
as it was altered quiet a bit to no longer mix different tasks, e.g.
joining a network and scanning for hidden networks, and removes no longer
needed options.

At the top-level '<wifi_config>' node the following alterations where made.

* The 'log_level' attribute was added and configures the supplicant's
  verbosity. Valid values correspond to levels used by the supplicant
  and are as follows 'excessive', 'msgdump', 'debug', 'info', 'warning'
  and 'error'. The default value is 'error' and configures the least
  amount of verbosity. This option was introduced to ease the investigation
  of connectivity issues.

* The 'bgscan' attribute may be used to configure the way the
  supplicant performs background-scanning to steer or rather optimize
  roaming decision within the same network. The default value is set
  to 'simple:30:-70:600'. It can be disabled by specifying an empty
  value, e.g. 'bgscan=""'.

* The 'connected_scan_interval' attribute was removed as this functionality
  is now covered by the background-scanning.

* The 'verbose_state' attribute was removed altogether and similar
  functionality is now covered by the 'verbose' attribute.

The network management received the following changes.

* Every configured network, denoted by a '<network>' node, is now implicitly
  considered an option for joining. The 'auto_connect' attribute was
  removed and a '<network> node must by renamed or removed instead.

* The intent to scan for a hidden network is now managed by the newly
  introduced '<explicit_scan>' node that like the '<network>' node has
  an 'ssid' attribute. If the specified SSID is valid, it is incorporated
  into the scan request to actively probe for this network.
  The 'explicit_scan' attribute of the '<network>' node was removed.

The following exemplary configuration shows how to configure the driver
for attempting to join two different networks and one of them is hidden.
The initial scan interval is set 10 seconds and the signal quality will be
updated every 30 seconds while connected to a network.

!<wifi_config scan_interval="10" update_quality_interval="30">
!  <explicit_scan ssid="Skynet"/>
!  <network ssid="Zero"   protection="WPA2" passphrase="allyourbase"/>
!  <network ssid="Skynet" protection="WPA3" passphrase="illbeback"/>
!</wifi_config>

For more information please consult 'repos/dde_linux/src/driver/wifi/README'
that now contains a 'Best practices' section that explains how the driver
should best be operated and highlights the difference between a managed
(as used in Sculpt) and user generated configuration.


Audio driver updated to OpenBSD 7.6
===================================

With this release we updated the audio driver based on OpenBSD to a
more recent revision that correlates to version 7.6. It supports
newer devices, e.g. Alder Lake-N, and includes a fix for using MSI
with HDA devices found in AMD-based systems.


AVX and hardware-based AES in virtual machines
==============================================

; @alex-ab

commit ff506b037537bf0d39f6414261d9367b07323c13
Author: Alexander Boettcher <alexander.boettcher@genode-labs.com>
Date:   Wed Sep 4 15:41:29 2024 +0200

    vm/x86: support extended fpu state transfer
    
    Extend Genode's vCPU FPU state and adjust all users to copy
    at most FPU data they actually support.
    
    Issue #5314

commit a07b5937d9fe15480ebb08d0200aaa44a4e184e0
Author: Alexander Boettcher <alexander.boettcher@genode-labs.com>
Date:   Fri Sep 13 10:52:38 2024 +0200

    nova: handle invalid FPU guest state
    
    Makes the kernel robust against invalid guest FPU state provided by a VMM,
    e.g. our port of Vbox6.
    
    Issue #5314

commit 75266e467df13e161a8e47215e2bde5e8622f298
Author: Alexander Boettcher <alexander.boettcher@genode-labs.com>
Date:   Thu Sep 5 09:54:42 2024 +0200

    vbox6: enable AVX support
    
    Issue #5314

commit e5df8da1bd696423f465bd4376c67ba4dfcc2798
Author: Alexander Boettcher <alexander.boettcher@genode-labs.com>
Date:   Tue Sep 17 10:58:15 2024 +0200

    vbox6: enable AES hardware instruction support
    
    Issue #5314

commit 4084df6360d91c82ed19e3cd97cdeafd11c48eb4
Author: Josef Söntgen <josef.soentgen@genode-labs.com>
Date:   Tue Oct 8 15:11:19 2024 +0200

    vbox6: enable RDRAND hardware instruction support
    
    Issue #5314

commit b17ec8e5f93a980f03d963b289735809ea879c1e
Author: Alexander Boettcher <alexander.boettcher@genode-labs.com>
Date:   Wed Nov 13 09:28:56 2024 +0100

    nova: support resume on AVX CPUs
    
    Issue #5314


Build system and tools
######################

Extended depot-tool safeguards
------------------------------

When using the run tool's '--depot-auto-update' feature while switching between
different git branches with commited recipe hashes, a binary archive present in
the depot may accidentally not match its ingredients because the depot/build
tool's 'REBUILD=' mode - as used by the depot auto-update mechanism - merely
looks at the archive versions. This situation is arguably rare. But when it
occurs, its reach and effects are hard to predict. To rule out this corner
case early, the depot/build tool has now been extended by recording the hashes
of the ingredients of binary archives. When skipping a rebuild because the
desired version presumably already exists as a binary archive, the recorded
hashes are compared to the current state of the ingredients (src and api
archives). Thereby inconsistencies are reported to the user.

Users of the depot tool will notice .hash files appearing alongside src and
api archives. Those files contain the hash value of the content of the
respective archive. Each binary archive built is now also accompanied by a
.hash file, which contains a list of hash values of the ingredients that went
into the binary archive. Thanks to these .hash files, the consistency between
binaries and their ingredients can be checked quickly.

_As a note of caution, when switching to the Genode 24.11 with existing depot,_
_one will possibly need to remove existing depot archives (as listed by the_
_diagnostic messages) because the existing archives are not accompanied with_
_.hash files yet._
